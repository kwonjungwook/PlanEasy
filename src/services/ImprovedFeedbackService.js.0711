// src/services/ImprovedFeedbackService.js
import AsyncStorage from "@react-native-async-storage/async-storage";
import {
  differenceInDays,
  endOfMonth,
  endOfWeek,
  format,
  startOfMonth,
  startOfWeek,
} from "date-fns";
// DeepSeek API ì„¤ì •
const DEEPSEEK_API_KEY = "sk-d2615252b15242ee96fe3686c8ad045a";
const DEEPSEEK_API_URL = "https://api.deepseek.com/v1/chat/completions";

// ì‹¤ì œ ì‚¬ìš©ì ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜
const buildRealUserData = (date, reportType, plannerData) => {
  const { schedules, tasks, studySessions, goalTargets } = plannerData;

  // ìµœê·¼ 7ì¼ ë°ì´í„° ìˆ˜ì§‘
  const recentDates = [];
  for (let i = 6; i >= 0; i--) {
    const pastDate = new Date();
    pastDate.setDate(pastDate.getDate() - i);
    recentDates.push(format(pastDate, "yyyy-MM-dd"));
  }

  // ìµœê·¼ ìŠ¤ì¼€ì¤„ ë¶„ì„
  const recentSchedules = [];
  let totalTasks = 0;
  let completedTasks = 0;

  recentDates.forEach((dateStr) => {
    const daySchedules = schedules[dateStr] || [];
    const dayTasks = tasks[dateStr] || {};

    totalTasks += Object.keys(dayTasks).length;
    completedTasks += Object.values(dayTasks).filter(Boolean).length;

    daySchedules.forEach((schedule) => {
      recentSchedules.push({
        task: schedule.task,
        startTime: schedule.startTime,
        completed: dayTasks[schedule.id] || false,
        date: dateStr,
      });
    });
  });

  const completionRate =
    totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

  // ìŠ¤í„°ë”” ì„¸ì…˜ ë¶„ì„
  let totalStudyTime = 0;
  const subjectDistribution = {};
  const studyTimePatterns = [];

  recentDates.forEach((dateStr) => {
    const daySessions = studySessions[dateStr] || [];
    daySessions.forEach((session) => {
      totalStudyTime += session.duration || 0;
      const subject = session.subject || "ê¸°íƒ€";
      subjectDistribution[subject] =
        (subjectDistribution[subject] || 0) + (session.duration || 0);

      if (session.timestamp) {
        const time = format(new Date(session.timestamp), "HH:mm");
        if (!studyTimePatterns.includes(time)) {
          studyTimePatterns.push(time);
        }
      }
    });
  });

  const totalStudyHours = Math.round((totalStudyTime / 3600) * 10) / 10;

  // ì‹œê°„ë³„ í™œë™ íŒ¨í„´ ë¶„ì„
  const hourlyActivity = {};
  recentSchedules.forEach((schedule) => {
    const hour = schedule.startTime.split(":")[0];
    hourlyActivity[hour] = (hourlyActivity[hour] || 0) + 1;
  });

  const mostActiveHours = Object.entries(hourlyActivity)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 3)
    .map(([hour]) => `${hour}:00`);

  // ì‘ì—… ìŠ¤íƒ€ì¼ ì¶”ë¡ 
  const morningActivity =
    hourlyActivity["07"] + hourlyActivity["08"] + hourlyActivity["09"] || 0;
  const eveningActivity =
    hourlyActivity["18"] + hourlyActivity["19"] + hourlyActivity["20"] || 0;
  const workStyle =
    morningActivity > eveningActivity
      ? "morning_person"
      : eveningActivity > morningActivity
      ? "evening_person"
      : "balanced";

  // í™œì„± ëª©í‘œ ë° ê¸´ê¸‰ ëª©í‘œ ë¶„ì„ (D-Day ì •ë³´ ê°•í™”)
  const today = new Date();
  const activeGoals = goalTargets.filter(
    (goal) => new Date(goal.targetDate) > today
  );
  const urgentGoals = activeGoals.filter((goal) => {
    const daysLeft = Math.ceil(
      (new Date(goal.targetDate) - today) / (1000 * 60 * 60 * 24)
    );
    return daysLeft <= 7;
  });

  // D-Day ìƒì„¸ ì •ë³´ ê³„ì‚°
  const ddayInfo = goalTargets.map((goal) => {
    const targetDate = new Date(goal.targetDate);
    const daysLeft = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));

    let urgencyLevel = "normal";
    let priority = "medium";

    if (daysLeft <= 0) {
      urgencyLevel = "completed_or_overdue";
      priority = "completed";
    } else if (daysLeft <= 1) {
      urgencyLevel = "critical";
      priority = "critical";
    } else if (daysLeft <= 3) {
      urgencyLevel = "urgent";
      priority = "high";
    } else if (daysLeft <= 7) {
      urgencyLevel = "important";
      priority = "high";
    } else if (daysLeft <= 14) {
      urgencyLevel = "moderate";
      priority = "medium";
    }

    return {
      title: goal.title,
      category: goal.category,
      targetDate: goal.targetDate,
      daysLeft: daysLeft,
      dDayText:
        daysLeft === 0
          ? "D-Day"
          : daysLeft > 0
          ? `D-${daysLeft}`
          : `D+${Math.abs(daysLeft)}`,
      urgencyLevel: urgencyLevel,
      priority: priority,
      recommendedDailyHours: getRecommendedHours(goal.category),
      description: goal.description || "",
    };
  });

  // ìš°ì„ ìˆœìœ„ë³„ ì •ë ¬
  ddayInfo.sort((a, b) => {
    const priorityOrder = { critical: 0, high: 1, medium: 2, completed: 3 };
    return priorityOrder[a.priority] - priorityOrder[b.priority];
  });

  // ê¶Œì¥ ì¼ì¼ í•™ìŠµì‹œê°„ ê³„ì‚° í•¨ìˆ˜
  function getRecommendedHours(category) {
    const recommendations = {
      ì‹œí—˜: 4,
      ìê²©ì¦: 3,
      ì–´í•™: 2,
      í”„ë¡œì íŠ¸: 3,
      ì·¨ì—…ì¤€ë¹„: 4,
      ê¸°íƒ€: 2,
    };
    return recommendations[category] || 2;
  }

  return {
    targetDate: date,
    reportType: reportType,
    currentTime: new Date().toISOString(),

    // ì‹¤ì œ í™œë™ ë°ì´í„°
    schedules: {
      recent: recentSchedules.slice(-10), // ìµœê·¼ 10ê°œ
      completionRate: completionRate,
      patterns:
        workStyle === "morning_person"
          ? ["morning_active"]
          : workStyle === "evening_person"
          ? ["evening_active"]
          : ["balanced_activity"],
    },

    // ì‹¤ì œ í•™ìŠµ ë°ì´í„°
    studySessions: {
      totalHours: totalStudyHours,
      subjectDistribution: subjectDistribution,
      timePatterns: studyTimePatterns.slice(0, 3),
    },

    // ì‹¤ì œ ëª©í‘œ í˜„í™© (D-Day ì •ë³´ ê°•í™”)
    goals: {
      active: activeGoals.map((goal) => ({
        title: goal.title,
        targetDate: goal.targetDate,
        category: goal.category,
      })),
      urgent: urgentGoals.map((goal) => ({
        title: goal.title,
        targetDate: goal.targetDate,
        category: goal.category,
      })),
      // D-Day ìƒì„¸ ì •ë³´ ì¶”ê°€
      ddayDetails: ddayInfo,
      totalDailyTargetHours: ddayInfo
        .filter((goal) => goal.priority !== "completed")
        .reduce((sum, goal) => sum + goal.recommendedDailyHours, 0),
      criticalCount: ddayInfo.filter((goal) => goal.urgencyLevel === "critical")
        .length,
      urgentCount: ddayInfo.filter((goal) => goal.urgencyLevel === "urgent")
        .length,
    },

    // ì‹¤ì œ ì„±ê³¼ ì§€í‘œ
    performance: {
      weeklyCompletionRate: completionRate,
      streakDays: 5, // ì´ê±´ ProgressContextì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨
      productivityTrend:
        completionRate >= 70
          ? "improving"
          : completionRate >= 40
          ? "stable"
          : "declining",
    },

    // ì‹¤ì œ ì‚¬ìš©ì ì„ í˜¸ë„
    preferences: {
      mostActiveHours: mostActiveHours,
      workStyle: workStyle,
    },
  };
};

// ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„± (D-Day ì •ë³´ ê°•í™”)
const getSystemPrompt = (reportType) => {
  return `ë‹¹ì‹ ì€ ì „ë¬¸ ì¼ì • ê´€ë¦¬ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.
ì‚¬ìš©ìì˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì‹¤ìš©ì ì´ê³  ê°œì¸í™”ëœ ì¼ì • ì¶”ì²œì„ ì œê³µí•´ì£¼ì„¸ìš”.

**íŠ¹ë³„ ê³ ë ¤ì‚¬í•­:**
- D-Day ëª©í‘œì˜ ê¸´ê¸‰ë„ë¥¼ ë°˜ë“œì‹œ ê³ ë ¤í•˜ì„¸ìš” (Critical > Urgent > Important > Normal)
- ê¶Œì¥ ì¼ì¼ í•™ìŠµì‹œê°„ê³¼ ì‹¤ì œ í•™ìŠµì‹œê°„ì˜ ì°¨ì´ë¥¼ ë¶„ì„í•˜ì„¸ìš”
- ì‚¬ìš©ìì˜ í™œë™ íŒ¨í„´(ì•„ì¹¨í˜•/ì €ë…í˜•)ì— ë§ì¶° ì¼ì •ì„ ë°°ì¹˜í•˜ì„¸ìš”
- ì™„ë£Œìœ¨ì´ ë‚®ë‹¤ë©´ í˜„ì‹¤ì ì¸ ëª©í‘œ ì¡°ì •ì„ ì œì•ˆí•˜ì„¸ìš”

**ì‘ë‹µ í˜•ì‹ (ë°˜ë“œì‹œ JSONìœ¼ë¡œ):**
{
  "analysis": "ì‚¬ìš©ì íŒ¨í„´ ë° D-Day í˜„í™© ë¶„ì„ (í•œêµ­ì–´, 2-3ë¬¸ì¥)",
  "recommendations": [
    {
      "time": "HH:MM",
      "task": "êµ¬ì²´ì ì¸ í•  ì¼",
      "category": "ì¹´í…Œê³ ë¦¬",
      "priority": "critical|high|medium|low",
      "reason": "ì¶”ì²œ ì´ìœ  (D-Day ê³ ë ¤ì‚¬í•­ í¬í•¨)",
      "related_goal": "ê´€ë ¨ D-Day ëª©í‘œëª… (ìˆëŠ” ê²½ìš°)"
    }
  ],
  "insights": "D-Day ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ê°œì¸í™”ëœ ì¡°ì–¸ (í•œêµ­ì–´, 3-4ë¬¸ì¥)",
  "focus_areas": ["D-Day ê´€ë ¨ ì§‘ì¤‘ì˜ì—­1", "ì˜ì—­2", "ì˜ì—­3"],
  "dday_strategy": "D-Day ëª©í‘œ ë‹¬ì„± ì „ëµ (í•œêµ­ì–´, 2-3ë¬¸ì¥)"
}

${
  reportType === "daily"
    ? "ì˜¤ëŠ˜ í•˜ë£¨ D-Day ëª©í‘œì— ì§‘ì¤‘í•œ ìµœì  ì¼ì •ì„ ì œì•ˆí•´ì£¼ì„¸ìš”."
    : reportType === "weekly"
    ? "ì´ë²ˆ ì£¼ D-Day ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì „ì²´ ê³„íšì„ ì œì•ˆí•´ì£¼ì„¸ìš”."
    : "ì´ë²ˆ ë‹¬ ì¥ê¸° D-Day ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì „ëµì  ì¼ì •ì„ ì œì•ˆí•´ì£¼ì„¸ìš”."
}`;
};

// ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ìƒì„± (ì‹¤ì œ ë°ì´í„° ë°˜ì˜)
const buildUserPrompt = (userData) => {
  const hasData =
    userData.schedules.recent.length > 0 ||
    userData.studySessions.totalHours > 0 ||
    userData.goals.active.length > 0;

  if (!hasData) {
    return `**ì‚¬ìš©ì í˜„í™© ë¶„ì„:**

ğŸ“… ë‚ ì§œ: ${userData.targetDate}
ğŸ“Š ë¦¬í¬íŠ¸ íƒ€ì…: ${userData.reportType}

**í˜„ì¬ ìƒí™©:**
- ì•„ì§ ì¶©ë¶„í•œ í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤
- ì¼ì •, í•™ìŠµ ê¸°ë¡, ëª©í‘œ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤

**ê¶Œì¥ì‚¬í•­:**
- ì¼ìƒì ì¸ ì¼ì •ì„ ë“±ë¡í•´ë³´ì„¸ìš”
- í•™ìŠµ ì‹œê°„ì„ ê¸°ë¡í•´ë³´ì„¸ìš”  
- ë‹¬ì„±í•˜ê³  ì‹¶ì€ ëª©í‘œë¥¼ ì„¤ì •í•´ë³´ì„¸ìš”

ê¸°ë³¸ì ì¸ ìƒì‚°ì„± í–¥ìƒì„ ìœ„í•œ ${userData.reportType} ì¼ì •ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”.`;
  }

  return `**ì‚¬ìš©ì í˜„í™© ë¶„ì„:**

ğŸ“… ë‚ ì§œ: ${userData.targetDate}
ğŸ“Š ë¦¬í¬íŠ¸ íƒ€ì…: ${userData.reportType}

**ìµœê·¼ í™œë™ íŒ¨í„´:**
- ì¼ì • ì™„ë£Œìœ¨: ${userData.performance.weeklyCompletionRate}%
- ì—°ì† ì¶œì„: ${userData.performance.streakDays}ì¼
- ì£¼ìš” í™œë™ ì‹œê°„ëŒ€: ${
    userData.preferences.mostActiveHours.join(", ") || "ì •ë³´ ì—†ìŒ"
  }
- ì‘ì—… ìŠ¤íƒ€ì¼: ${userData.preferences.workStyle}

**í•™ìŠµ í˜„í™©:**
- ì´ í•™ìŠµ ì‹œê°„: ${userData.studySessions.totalHours}ì‹œê°„
- ì£¼ìš” ê³¼ëª©: ${
    Object.keys(userData.studySessions.subjectDistribution)
      .slice(0, 3)
      .join(", ") || "ê¸°ë¡ ì—†ìŒ"
  }

**ëª©í‘œ í˜„í™©:**
${
  userData.goals.active.length > 0
    ? userData.goals.active
        .map((goal) => `- ${goal.title} (${goal.category})`)
        .join("\n")
    : "- ì„¤ì •ëœ ëª©í‘œ ì—†ìŒ"
}

**D-Day ìƒì„¸ í˜„í™©:**
${
  userData.goals.ddayDetails && userData.goals.ddayDetails.length > 0
    ? userData.goals.ddayDetails
        .slice(0, 5)
        .map(
          (goal) =>
            `- ${goal.title}: ${goal.dDayText} (${goal.urgencyLevel}, ê¶Œì¥ ${goal.recommendedDailyHours}h/ì¼)`
        )
        .join("\n")
    : "- D-Day ëª©í‘œ ì—†ìŒ"
}

**ëª©í‘œ ìš°ì„ ìˆœìœ„ ë¶„ì„:**
- ì´ ê¶Œì¥ ì¼ì¼ í•™ìŠµì‹œê°„: ${userData.goals.totalDailyTargetHours || 0}ì‹œê°„/ì¼
- ìœ„í—˜(Critical): ${userData.goals.criticalCount || 0}ê°œ
- ê¸´ê¸‰(Urgent): ${userData.goals.urgentCount || 0}ê°œ
- í˜„ì¬ ì‹¤ì œ í•™ìŠµì‹œê°„: ${userData.studySessions.totalHours}ì‹œê°„/ì£¼

**ê¸´ê¸‰ ëª©í‘œ:**
${
  userData.goals.urgent.length > 0
    ? userData.goals.urgent.map((goal) => `- âš ï¸ ${goal.title}`).join("\n")
    : "- ê¸´ê¸‰í•œ ëª©í‘œ ì—†ìŒ"
}

**ìµœê·¼ ìŠ¤ì¼€ì¤„:**
${
  userData.schedules.recent.length > 0
    ? userData.schedules.recent
        .slice(-5)
        .map(
          (schedule) =>
            `- ${schedule.startTime} ${schedule.task} ${
              schedule.completed ? "âœ…" : "âŒ"
            }`
        )
        .join("\n")
    : "- ê¸°ë¡ëœ ìŠ¤ì¼€ì¤„ ì—†ìŒ"
}

ì´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ${userData.reportType} ë§ì¶¤ ì¼ì •ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”.
${
  userData.goals.urgent.length > 0
    ? "íŠ¹íˆ ê¸´ê¸‰í•œ ëª©í‘œë¥¼ ìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•´ì£¼ì„¸ìš”."
    : ""
}`;
};

// DeepSeek API í˜¸ì¶œ í•¨ìˆ˜ (ì‹¤ì œ ë°ì´í„° ì‚¬ìš©)
export const testDeepSeekAPI = async (
  reportType = "daily",
  plannerData = null
) => {
  try {
    console.log("ğŸš€ DeepSeek API í…ŒìŠ¤íŠ¸ ì‹œì‘...");

    // ì‹¤ì œ ë°ì´í„° ì‚¬ìš© (plannerDataê°€ ìˆìœ¼ë©´)
    let userData;
    if (plannerData) {
      userData = buildRealUserData(
        format(new Date(), "yyyy-MM-dd"),
        reportType,
        plannerData
      );
      console.log("ğŸ“Š ì‹¤ì œ ì‚¬ìš©ì ë°ì´í„° ì‚¬ìš©:", userData);
    } else {
      // í…ŒìŠ¤íŠ¸ìš© fallback ë°ì´í„°
      userData = {
        targetDate: format(new Date(), "yyyy-MM-dd"),
        reportType: reportType,
        schedules: { recent: [], completionRate: 0 },
        studySessions: { totalHours: 0, subjectDistribution: {} },
        goals: { active: [], urgent: [] },
        performance: { weeklyCompletionRate: 0, streakDays: 0 },
        preferences: { mostActiveHours: [], workStyle: "balanced" },
      };
      console.log("âš ï¸ ë°ì´í„° ì—†ìŒ, ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©");
    }

    // í”„ë¡¬í”„íŠ¸ êµ¬ì„±
    const systemPrompt = getSystemPrompt(reportType);
    const userPrompt = buildUserPrompt(userData);

    console.log("ğŸ“¤ API ìš”ì²­ ì¤‘...");

    // API í˜¸ì¶œ
    const response = await fetch(DEEPSEEK_API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${DEEPSEEK_API_KEY}`,
      },
      body: JSON.stringify({
        model: "deepseek-chat",
        messages: [
          {
            role: "system",
            content: systemPrompt,
          },
          {
            role: "user",
            content: userPrompt,
          },
        ],
        temperature: 0.7,
        max_tokens: 1500,
        response_format: { type: "json_object" },
      }),
    });

    if (!response.ok) {
      throw new Error(
        `API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`
      );
    }

    const result = await response.json();
    console.log("âœ… API ì‘ë‹µ ë°›ìŒ:", result);

    // JSON íŒŒì‹±
    const aiContent = JSON.parse(result.choices[0].message.content);

    return {
      success: true,
      data: {
        ...aiContent,
        metadata: {
          requestTime: new Date().toISOString(),
          reportType: reportType,
          tokensUsed: result.usage?.total_tokens || 0,
          dataSource: plannerData ? "real_user_data" : "fallback_data",
        },
      },
    };
  } catch (error) {
    console.error("âŒ DeepSeek API í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:", error);
    return {
      success: false,
      error: error.message,
      fallback: {
        analysis:
          "ì‹¤ì œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ë” ë§ì€ ë°ì´í„°ê°€ ìŒ“ì´ë©´ ì •í™•í•œ ë¶„ì„ì„ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤.",
        recommendations: [
          {
            time: "09:00",
            task: "ì¤‘ìš”í•œ ì—…ë¬´ ì²˜ë¦¬",
            category: "ì—…ë¬´",
            priority: "high",
            reason: "ì•„ì¹¨ ì§‘ì¤‘ë ¥ í™œìš©",
          },
        ],
        insights:
          "ê°œì¸í™”ëœ ë¶„ì„ì„ ìœ„í•´ ë” ë§ì€ í™œë™ ê¸°ë¡ì´ í•„ìš”í•©ë‹ˆë‹¤. ê¾¸ì¤€íˆ ì¼ì •ê³¼ í•™ìŠµì„ ê¸°ë¡í•´ì£¼ì„¸ìš”.",
        focus_areas: ["í™œë™ ê¸°ë¡ ëŠ˜ë¦¬ê¸°", "ê¾¸ì¤€í•œ ìŠµê´€ í˜•ì„±", "ëª©í‘œ ì„¤ì •"],
      },
    };
  }
};

// ìŠ¤í† ë¦¬ì§€ í‚¤
const STORAGE_KEYS = {
  REPORTS: "@feedback_reports",
  LAST_VIEWED_WEEKLY: "@last_viewed_weekly_report",
  LAST_VIEWED_MONTHLY: "@last_viewed_monthly_report",
  NOTIFICATIONS_SETUP: "report_notifications_setup",
};

// ë¦¬í¬íŠ¸ íƒ€ì…
export const REPORT_TYPES = {
  DAILY: "daily",
  WEEKLY: "weekly",
  MONTHLY: "monthly",
};

// ìë™ ê°±ì‹  ì£¼ê¸° (ë°€ë¦¬ì´ˆ)
const AUTO_REFRESH_INTERVALS = {
  [REPORT_TYPES.DAILY]: 5 * 60 * 1000, // 5ë¶„
  [REPORT_TYPES.WEEKLY]: 24 * 60 * 60 * 1000, // 1ì¼
  [REPORT_TYPES.MONTHLY]: 7 * 24 * 60 * 60 * 1000, // 1ì£¼ì¼
};

// ì½œë°± í•¨ìˆ˜ë¥¼ ì €ì¥í•  ë³€ìˆ˜
let reportCallbackFunction = null;

// ì½œë°± í•¨ìˆ˜ ì„¤ì • í•¨ìˆ˜ - ë¬´í•œ ì¬ê·€ ë°©ì§€ ê¸°ëŠ¥ ì¶”ê°€
export const setReportCallback = (callback) => {
  if (typeof callback === "function") {
    // ë¬´í•œ ì¬ê·€ ë°©ì§€ë¥¼ ìœ„í•´ generateFeedbackì€ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ê²½ê³ 
    console.log(
      "ë¦¬í¬íŠ¸ ì½œë°± í•¨ìˆ˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ì˜: ì½œë°± ë‚´ì—ì„œ generateFeedbackì„ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”."
    );

    // ì½œë°± í•¨ìˆ˜ ë¬´ì‹œ (ë¬´í•œ ì¬ê·€ ë°©ì§€ë¥¼ ìœ„í•´)
    // ì´ í•¨ìˆ˜ëŠ” í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€ë˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
    reportCallbackFunction = null;
    return true;
  }
  console.error("ìœ íš¨í•˜ì§€ ì•Šì€ ì½œë°± í•¨ìˆ˜ì…ë‹ˆë‹¤");
  return false;
};

// ì‚¬ì „ ì •ì˜ëœ ë‹¤ì–‘í•œ í”¼ë“œë°± ë©˜íŠ¸ ëª¨ìŒ
export const FEEDBACK_MESSAGES = {
  // ì¼ê°„ ë¦¬í¬íŠ¸ ì¸ì‚¬ì´íŠ¸ ë©”ì‹œì§€ (í•™ìŠµ ì‹œê°„ ê¸°ì¤€)
  dailyInsights: [
    // 0-1ì‹œê°„: ì‹œì‘ì´ ì¤‘ìš”í•¨ì„ ê°•ì¡°
    {
      range: [0, 1],
      messages: [
        "ì˜¤ëŠ˜ì€ í•™ìŠµì„ ì‹œì‘í–ˆë„¤ìš”. ì²« ê±¸ìŒì´ í•­ìƒ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤.",
        "ì§§ì€ ì‹œê°„ì´ë¼ë„ ê³µë¶€ë¥¼ ì‹œì‘í•œ ê²ƒì€ ì˜ë¯¸ìˆëŠ” ì¼ì…ë‹ˆë‹¤.",
        "ê¾¸ì¤€í•¨ì´ ì‹¤ë ¥ì„ ë§Œë“­ë‹ˆë‹¤. ì˜¤ëŠ˜ ì‹œì‘ì´ ë‚´ì¼ì˜ ì„±ì¥ìœ¼ë¡œ ì´ì–´ì§ˆ ê±°ì˜ˆìš”.",
        "ë§ˆìŒì„ ëª¨ìœ¼ê¸° ì–´ë ¤ìš´ ë‚ ë„ ìˆì–´ìš”. ë‚´ì¼ì€ ë” ì§‘ì¤‘í•´ë³¼ê¹Œìš”?",
        "ì§§ì€ ì‹œê°„ì˜ í•™ìŠµë„ ìŒ“ì´ë©´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
      ],
    },
    // 1-2ì‹œê°„: ê¾¸ì¤€í•œ ë…¸ë ¥ ì¹­ì°¬
    {
      range: [1, 2],
      messages: [
        "1ì‹œê°„ ì´ìƒ ì§‘ì¤‘í–ˆë„¤ìš”. ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ë¹›ì„ ë°œí•˜ê³  ìˆì–´ìš”.",
        "ì§‘ì¤‘í•œ ì‹œê°„ì´ ìŒ“ì´ê³  ìˆì–´ìš”. ê¾¸ì¤€í•¨ì´ ì‹¤ë ¥ì„ ë§Œë“­ë‹ˆë‹¤.",
        "ì˜¤ëŠ˜ë„ ì˜ë¯¸ìˆëŠ” ì‹œê°„ì„ ë³´ëƒˆë„¤ìš”. ì´ëŸ° ë‚ ë“¤ì´ ëª¨ì—¬ ì„±ì¥ì´ ë©ë‹ˆë‹¤.",
        "ì ë‹¹í•œ í•™ìŠµ ì‹œê°„ì„ ìœ ì§€í•˜ê³  ìˆì–´ìš”. ê· í˜• ì¡íŒ í•™ìŠµ íŒ¨í„´ì…ë‹ˆë‹¤.",
        "ê¾¸ì¤€íˆ í•™ìŠµí•˜ëŠ” ìŠµê´€ì´ ì¢‹ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ê±°ì˜ˆìš”.",
      ],
    },
    // 2-4ì‹œê°„: ì¢‹ì€ íŒ¨í„´ í˜•ì„± ì¤‘ì„ì„ ê²©ë ¤
    {
      range: [2, 4],
      messages: [
        "ìƒë‹¹í•œ ì‹œê°„ì„ í•™ìŠµì— íˆ¬ìí–ˆë„¤ìš”. ì¢‹ì€ í•™ìŠµ íŒ¨í„´ì´ í˜•ì„±ë˜ê³  ìˆì–´ìš”.",
        "ì§‘ì¤‘ë ¥ì´ ë‹ë³´ì´ëŠ” í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤. ì´ëŸ° ë‚ ë“¤ì´ ì‹¤ë ¥ í–¥ìƒì˜ ì—´ì‡ ì˜ˆìš”.",
        "ê¾¸ì¤€íˆ ì‹œê°„ì„ íˆ¬ìí•˜ê³  ìˆì–´ìš”. ì´ëŸ° ë…¸ë ¥ì´ í° ì°¨ì´ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
        "í•™ìŠµì— ì¶©ë¶„í•œ ì‹œê°„ì„ íˆ¬ìí–ˆì–´ìš”. í•˜ë£¨í•˜ë£¨ ì„±ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
        "ì¢‹ì€ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•˜ê³  ìˆì–´ìš”. ì§€ì‹ì€ ê¾¸ì¤€í•œ ë…¸ë ¥ìœ¼ë¡œ ìŒ“ì…ë‹ˆë‹¤.",
      ],
    },
    // 4ì‹œê°„ ì´ìƒ: ì—´ì • ë†’ì€ í•™ìŠµ ì¹­ì°¬, ê· í˜• ì¡°ì–¸
    {
      range: [4, 100],
      messages: [
        "ì •ë§ ë§ì€ ì‹œê°„ì„ í•™ìŠµì— íˆ¬ìí–ˆë„¤ìš”! ì—´ì •ì´ ëŒ€ë‹¨í•©ë‹ˆë‹¤.",
        "ì˜¤ëŠ˜ì€ íŠ¹ë³„íˆ ì§‘ì¤‘ë ¥ì´ ë†’ì€ ë‚ ì´ì—ˆêµ°ìš”. ëŒ€ë‹¨í•œ ë…¸ë ¥ì…ë‹ˆë‹¤.",
        "ì¥ì‹œê°„ í•™ìŠµì— ì •ë§ ìˆ˜ê³ í•˜ì…¨ì–´ìš”. ì¶©ë¶„í•œ íœ´ì‹ë„ ìŠì§€ ë§ˆì„¸ìš”.",
        "ì—´ì •ì ì¸ í•™ìŠµ íƒœë„ê°€ ë‹ë³´ì…ë‹ˆë‹¤. ê· í˜• ìˆëŠ” íœ´ì‹ë„ ì¤‘ìš”í•´ìš”.",
        "ê¹Šì´ ìˆëŠ” í•™ìŠµì´ ì´ë£¨ì–´ì§„ í•˜ë£¨ë„¤ìš”. ì´ëŸ° ë‚ ë“¤ì´ í° ì„±ì¥ì„ ë§Œë“­ë‹ˆë‹¤.",
      ],
    },
    // í•™ìŠµì´ ì—†ì„ ë•Œ
    {
      range: [-1, 0],
      messages: [
        "ì˜¤ëŠ˜ì€ ê¸°ë¡ëœ í•™ìŠµì´ ì—†ë„¤ìš”. ë‚´ì¼ ìƒˆë¡œìš´ ë§ˆìŒìœ¼ë¡œ ì‹œì‘í•´ë´ìš”.",
        "ë•Œë¡œëŠ” ì¶©ì „ì˜ ì‹œê°„ë„ í•„ìš”í•©ë‹ˆë‹¤. ë‚´ì¼ì„ ìœ„í•´ ì—ë„ˆì§€ë¥¼ ëª¨ì•„ë³´ì„¸ìš”.",
        "íœ´ì‹ë„ í•™ìŠµì˜ ì¼ë¶€ì…ë‹ˆë‹¤. ë‚´ì¼ ë‹¤ì‹œ ì‹œì‘í•´ë´ìš”.",
        "ì˜¤ëŠ˜ì€ ë‹¤ë¥¸ ì¼ë¡œ ë°”ë¹´ë‚˜ìš”? ë‚´ì¼ ë‹¤ì‹œ í˜ì´ìŠ¤ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.",
        "ëª¨ë“  ë‚ ì´ ì™„ë²½í•  ìˆ˜ëŠ” ì—†ì–´ìš”. ë‚´ì¼ ë‹¤ì‹œ ë„ì „í•´ë´ìš”.",
      ],
    },
  ],

  // ì¼ê°„ ë¦¬í¬íŠ¸ ì¶”ì²œ ë©”ì‹œì§€ (ì™„ë£Œìœ¨ ê¸°ì¤€)
  dailyRecommendations: [
    // 0-30%: ì¼ì • ê´€ë¦¬ ì¡°ì–¸
    {
      range: [0, 30],
      messages: [
        "ì¼ì • ê´€ë¦¬ì— ì–´ë ¤ì›€ì´ ìˆì–´ ë³´ì—¬ìš”. ë” í˜„ì‹¤ì ì¸ ê³„íšì„ ì„¸ì›Œë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
        "í•  ì¼ ëª©ë¡ì„ ë” ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ë©´ ì„±ì·¨ê°ì„ ë” ìì£¼ ëŠë‚„ ìˆ˜ ìˆì–´ìš”.",
        "ê°€ì¥ ì¤‘ìš”í•œ ì¼ 3ê°€ì§€ë§Œ ì„ íƒí•´ì„œ ì§‘ì¤‘í•´ë³´ì„¸ìš”.",
        "ì¼ì •ì„ ì†Œí™”í•˜ê¸° ì–´ë ¤ì› ë˜ ì´ìœ ë¥¼ ìƒê°í•´ë³´ê³ , ë‚´ì¼ì€ ì¡°ê¸ˆ ë” í˜„ì‹¤ì ì¸ ê³„íšì„ ì„¸ì›Œë³´ì„¸ìš”.",
        "ë•Œë¡œëŠ” 'í•˜ì§€ ì•Šê¸°ë¡œ ê²°ì •í•œ ì¼'ì„ ì •í•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•´ìš”. ìš°ì„ ìˆœìœ„ë¥¼ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.",
      ],
    },
    // 30-60%: ê°œì„  ë°©í–¥ ì œì‹œ
    {
      range: [30, 60],
      messages: [
        "ì ˆë°˜ ì •ë„ì˜ ì¼ì •ì„ ì™„ë£Œí–ˆë„¤ìš”. ìš°ì„ ìˆœìœ„ë¥¼ ë” ëª…í™•íˆ í•˜ë©´ ì¤‘ìš”í•œ ì¼ë¶€í„° ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ìš”.",
        "ì‹œê°„ ê´€ë¦¬ ê¸°ë²•ì„ í™œìš©í•´ë³´ì„¸ìš”. í¬ëª¨ë„ë¡œë‚˜ íƒ€ì„ë¸”ë¡ ë°©ì‹ì´ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”.",
        "ì™„ë£Œí•˜ì§€ ëª»í•œ ì¼ì • ì¤‘ ë‚´ì¼ë¡œ ë¯¸ë£° ìˆ˜ ìˆëŠ” ê²ƒê³¼ ê¼­ í•´ì•¼ í•˜ëŠ” ê²ƒì„ êµ¬ë¶„í•´ë³´ì„¸ìš”.",
        "ì§‘ì¤‘ì´ ì˜ ë˜ëŠ” ì‹œê°„ëŒ€ì— ì¤‘ìš”í•œ ì¼ì„ ë°°ì¹˜í•´ë³´ì„¸ìš”.",
        "ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì ì§„ì ì¸ ê°œì„ ì´ ì´ë£¨ì–´ì§€ê³  ìˆì–´ìš”. ì¡°ê¸ˆì”© ì™„ë£Œìœ¨ì„ ë†’ì—¬ë³´ì„¸ìš”.",
      ],
    },
    // 60-80%: ê¸ì •ì  í”¼ë“œë°±ê³¼ ì¡°ì–¸
    {
      range: [60, 80],
      messages: [
        "ìƒë‹¹ìˆ˜ì˜ ì¼ì •ì„ ì˜ ì™„ë£Œí–ˆì–´ìš”. ë¯¸ì™„ë£Œ í•­ëª©ì˜ ê³µí†µì ì„ ì°¾ì•„ ê°œì„ í•´ë³´ì„¸ìš”.",
        "ì¢‹ì€ ì™„ë£Œìœ¨ì…ë‹ˆë‹¤. ë” ë‚˜ì•„ê°€ê¸° ìœ„í•´ ì–´ì œë³´ë‹¤ ì˜¤ëŠ˜ ë” ë°œì „í•œ ì ì„ ìƒê°í•´ë³´ì„¸ìš”.",
        "ê³„íš ì‹¤í–‰ë ¥ì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ì œ ê° í™œë™ì˜ ì§ˆì„ ë†’ì´ëŠ” ë° ì§‘ì¤‘í•´ë³´ì„¸ìš”.",
        "ëŒ€ë¶€ë¶„ì˜ ì¼ì •ì„ ì˜ ì†Œí™”í–ˆì–´ìš”. ì™„ë£Œí•˜ì§€ ëª»í•œ ì¼ì€ ì •ë§ í•„ìš”í•œ ì¼ì¸ì§€ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.",
        "íš¨ìœ¨ì ì¸ ì¼ì • ê´€ë¦¬ê°€ ë‹ë³´ì…ë‹ˆë‹¤. ì¼ê³¼ íœ´ì‹ì˜ ê· í˜•ë„ ì˜ ìœ ì§€í•´ë³´ì„¸ìš”.",
      ],
    },
    // 80-100%: ë†’ì€ ì„±ì·¨ ì¶•í•˜ì™€ ìœ ì§€ ì¡°ì–¸
    {
      range: [80, 100],
      messages: [
        "ëŒ€ë¶€ë¶„ì˜ ì¼ì •ì„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí–ˆì–´ìš”! ì´ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•´ë³´ì„¸ìš”.",
        "í›Œë¥­í•œ ì™„ë£Œìœ¨ì…ë‹ˆë‹¤! ì´ëŸ° íš¨ìœ¨ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ë„ì „ì ì¸ ëª©í‘œë„ ì„¸ì›Œë³´ì„¸ìš”.",
        "ì˜¤ëŠ˜ì˜ ì„±ê³µ ìš”ì¸ì„ ë¶„ì„í•´ë³´ê³ , ì´ë¥¼ ë‹¤ë¥¸ ë‚ ì—ë„ ì ìš©í•´ë³´ì„¸ìš”.",
        "ë©‹ì§„ í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤! ì§€ê¸ˆì˜ ë£¨í‹´ì„ ë” ë°œì „ì‹œì¼œë³´ì„¸ìš”.",
        "ì™„ë²½ì— ê°€ê¹Œìš´ ì¼ì • ê´€ë¦¬ì˜€ì–´ìš”. ë¬´ë¦¬í•˜ì§€ ì•Šê³  ì´ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•©ë‹ˆë‹¤.",
      ],
    },
    // ì¼ì •ì´ ì—†ì„ ë•Œ
    {
      range: [-1, 0],
      messages: [
        "ì˜¤ëŠ˜ì€ ê³„íšëœ ì¼ì •ì´ ì—†ì—ˆë„¤ìš”. ë‚´ì¼ì€ ê°„ë‹¨í•œ to-do ë¦¬ìŠ¤íŠ¸ë¡œ ì‹œì‘í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
        "ê³„íš ì—†ì´ ë³´ë‚¸ ë‚ ë„ ìˆì„ ìˆ˜ ìˆì–´ìš”. ë‚´ì¼ì€ ì‘ì€ ëª©í‘œë¶€í„° ì„¸ì›Œë³´ì„¸ìš”.",
        "ë•Œë¡œëŠ” ê³„íš ì—†ëŠ” ë‚ ë„ í•„ìš”í•´ìš”. ë‚´ì¼ì„ ìœ„í•œ ê°„ë‹¨í•œ ê³„íšì„ ì„¸ì›Œë³´ëŠ” ê²ƒë„ ì¢‹ê² ë„¤ìš”.",
        "ì¼ì •ì„ ê´€ë¦¬í•˜ë©´ í•˜ë£¨ê°€ ë” íš¨ìœ¨ì ìœ¼ë¡œ ë³€í•  ìˆ˜ ìˆì–´ìš”. ë‚´ì¼ì€ ê°„ë‹¨í•œ ëª©í‘œë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.",
        "ê³„íšì´ ì—†ì—ˆë˜ ì˜¤ëŠ˜, ë¬´ì—‡ì„ ë°°ì› ë‚˜ìš”? ê·¸ ê²½í—˜ì„ ë‚´ì¼ì˜ ê³„íšì— ë°˜ì˜í•´ë³´ì„¸ìš”.",
      ],
    },
  ],

  // ì£¼ê°„ ë¦¬í¬íŠ¸ ê¸°ë³¸ í”¼ë“œë°± (í•™ìŠµ ì‹œê°„ ê¸°ì¤€)
  weeklyInsights: [
    // 0-5ì‹œê°„: ì‹œì‘ ë‹¨ê³„
    {
      range: [0, 5],
      messages: [
        "ì´ë²ˆ ì£¼ëŠ” í•™ìŠµ ì‹œê°„ì´ ë‹¤ì†Œ ì ì—ˆë„¤ìš”. ì‘ì€ ìŠµê´€ë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.",
        "ë§¤ì¼ ì§§ë”ë¼ë„ ê¾¸ì¤€íˆ ì‹œê°„ì„ íˆ¬ìí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
        "ì´ë²ˆ ì£¼ ê²½í—˜ì„ í† ëŒ€ë¡œ ë‹¤ìŒ ì£¼ëŠ” ë” ê·œì¹™ì ì¸ í•™ìŠµ íŒ¨í„´ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.",
        "ì ì€ ì‹œê°„ì´ë¼ë„ ê¾¸ì¤€íˆ í•™ìŠµí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒ ì£¼ëŠ” ì¡°ê¸ˆì”© ëŠ˜ë ¤ë³´ì„¸ìš”.",
        "í•™ìŠµì˜ ì‹œì‘ì ì— ì„œ ìˆë„¤ìš”. ì‘ì€ ê±¸ìŒì´ í° ë³€í™”ë¥¼ ê°€ì ¸ì˜¬ ê±°ì˜ˆìš”.",
      ],
    },
    // 5-10ì‹œê°„: ë°œì „ ë‹¨ê³„
    {
      range: [5, 10],
      messages: [
        "ì£¼ë‹¹ 5ì‹œê°„ ì´ìƒ í•™ìŠµí•˜ê³  ìˆì–´ìš”. ì¢‹ì€ í•™ìŠµ ìŠµê´€ì´ í˜•ì„±ë˜ê³  ìˆìŠµë‹ˆë‹¤.",
        "ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ë‹ë³´ì´ëŠ” í•œ ì£¼ì˜€ìŠµë‹ˆë‹¤. ì´ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•´ë³´ì„¸ìš”.",
        "ì¼ì£¼ì¼ ë™ì•ˆ ê· í˜• ì¡íŒ í•™ìŠµì´ ì´ë£¨ì–´ì¡Œë„¤ìš”. ì ì  ë” ë°œì „í•˜ê³  ìˆì–´ìš”.",
        "í•™ìŠµì— ìƒë‹¹í•œ ì‹œê°„ì„ íˆ¬ìí•˜ê³  ìˆì–´ìš”. íš¨ìœ¨ì„ ë†’ì´ëŠ” ë°©ë²•ë„ í•¨ê»˜ ê³ ë¯¼í•´ë³´ì„¸ìš”.",
        "ê¾¸ì¤€í•œ í•™ìŠµ íŒ¨í„´ì„ ë§Œë“¤ì–´ê°€ê³  ìˆì–´ìš”. ì§€ì‹ì€ ì´ëŸ° ê¾¸ì¤€í•¨ì—ì„œ ìŒ“ì…ë‹ˆë‹¤.",
      ],
    },
    // 10-20ì‹œê°„: ì§‘ì¤‘ ë‹¨ê³„
    {
      range: [10, 20],
      messages: [
        "ì¼ì£¼ì¼ ë™ì•ˆ ìƒë‹¹í•œ ì‹œê°„ì„ í•™ìŠµì— íˆ¬ìí–ˆë„¤ìš”. ì—´ì •ì´ ë‹ë³´ì…ë‹ˆë‹¤.",
        "ì£¼ë‹¹ 10ì‹œê°„ ì´ìƒì˜ í•™ìŠµì€ ë›°ì–´ë‚œ ì§‘ì¤‘ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ê· í˜• ìˆëŠ” íœ´ì‹ë„ í•¨ê»˜í•˜ì„¸ìš”.",
        "í•™ìŠµì— ì§„ì§€í•˜ê²Œ ì„í•˜ê³  ìˆêµ°ìš”. ì´ëŸ° ì§‘ì¤‘ë ¥ì´ í° ì„±ì¥ì„ ì´ëŒì–´ë‚¼ ê±°ì˜ˆìš”.",
        "í•™ìŠµì— ë§ì€ ì‹œê°„ì„ íˆ¬ìí•˜ê³  ìˆì–´ìš”. íš¨ìœ¨ì ì¸ í•™ìŠµë²•ë„ í•¨ê»˜ ì°¾ì•„ë³´ì„¸ìš”.",
        "ì—´ì •ì ì¸ í•™ìŠµ íƒœë„ê°€ ì—¿ë³´ì…ë‹ˆë‹¤. ì´ëŸ° ë…¸ë ¥ì€ ë°˜ë“œì‹œ ê²°ì‹¤ì„ ë§ºì„ ê±°ì˜ˆìš”.",
      ],
    },
    // 20ì‹œê°„ ì´ìƒ: ê³ ê¸‰ ë‹¨ê³„
    {
      range: [20, 100],
      messages: [
        "ì£¼ë‹¹ 20ì‹œê°„ ì´ìƒì˜ í•™ìŠµì€ ì •ë§ ë†€ë¼ìš´ ì§‘ì¤‘ë ¥ì…ë‹ˆë‹¤. ê±´ê°•ê´€ë¦¬ë„ í•¨ê»˜í•˜ì„¸ìš”.",
        "ì •ë§ ë§ì€ ì‹œê°„ì„ í•™ìŠµì— íˆ¬ìí•˜ê³  ìˆì–´ìš”. íš¨ìœ¨ê³¼ ê· í˜•ì„ í•¨ê»˜ ê³ ë ¤í•´ë³´ì„¸ìš”.",
        "ê³ ê°•ë„ í•™ìŠµì„ ìœ ì§€í•˜ê³  ìˆë„¤ìš”. ë²ˆì•„ì›ƒ ì—†ì´ ì§€ì† ê°€ëŠ¥í•œ í˜ì´ìŠ¤ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.",
        "ëŒ€ë‹¨í•œ í•™ìŠµëŸ‰ì…ë‹ˆë‹¤. ê¹Šì´ ìˆëŠ” ì§€ì‹ ìŠµë“ì´ ì´ë£¨ì–´ì§€ê³  ìˆì„ ê±°ì˜ˆìš”.",
        "ìµœìƒìœ„ ìˆ˜ì¤€ì˜ í•™ìŠµ ëª°ì…ë„ë¥¼ ë³´ì—¬ì£¼ê³  ìˆì–´ìš”. íœ´ì‹ê³¼ ê· í˜•ë„ ì±™ê¸°ì„¸ìš”.",
      ],
    },
    // í•™ìŠµì´ ì—†ì„ ë•Œ
    {
      range: [-1, 0],
      messages: [
        "ì´ë²ˆ ì£¼ëŠ” ê¸°ë¡ëœ í•™ìŠµì´ ì—†ë„¤ìš”. ìƒˆë¡œìš´ ì£¼ë¥¼ ì‹œì‘í•˜ë©° ì‘ì€ ëª©í‘œë¶€í„° ì„¸ì›Œë³´ì„¸ìš”.",
        "ë•Œë¡œëŠ” ì¬ì¶©ì „ì˜ ì‹œê°„ë„ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒ ì£¼ ìƒˆë¡œìš´ ë§ˆìŒìœ¼ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”.",
        "ì´ë²ˆ ì£¼ë¥¼ ëŒì•„ë³´ê³ , ë‹¤ìŒ ì£¼ì—ëŠ” ì–´ë–¤ ë³€í™”ë¥¼ ì¤„ ìˆ˜ ìˆì„ì§€ ìƒê°í•´ë³´ì„¸ìš”.",
        "í•™ìŠµ ë£¨í‹´ì„ ë§Œë“¤ê¸° ì–´ë ¤ì› ë‚˜ìš”? ë‹¤ìŒ ì£¼ëŠ” ì •í•´ì§„ ì‹œê°„ì— ì§§ê²Œë¼ë„ í•™ìŠµí•´ë³´ì„¸ìš”.",
        "ëª¨ë“  ì£¼ê°€ ìƒì‚°ì ì¼ ìˆ˜ëŠ” ì—†ì–´ìš”. ìƒˆë¡œìš´ ì£¼ë¥¼ ìœ„í•œ ì—ë„ˆì§€ë¥¼ ëª¨ì•„ë³´ì„¸ìš”.",
      ],
    },
  ],

  // ì£¼ê°„ ë¦¬í¬íŠ¸ ê¸°ë³¸ ì¶”ì²œ (ì™„ë£Œìœ¨ ê¸°ì¤€)
  weeklyRecommendations: [
    // 0-30%: ê¸°ë³¸ ì‹œìŠ¤í…œ ì¬êµ¬ì¶•
    {
      range: [0, 30],
      messages: [
        "ì¼ì • ê´€ë¦¬ ì‹œìŠ¤í…œì„ ì¬ì ê²€í•´ë³´ì„¸ìš”. ë” ë‹¨ìˆœí•˜ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ê³„íšì´ í•„ìš”í•  ìˆ˜ ìˆì–´ìš”.",
        "ë„ˆë¬´ ë§ì€ ì¼ì„ ê³„íší•˜ì§„ ì•Šì•˜ë‚˜ìš”? ì¤‘ìš”í•œ ì¼ ìœ„ì£¼ë¡œ ìš°ì„ ìˆœìœ„ë¥¼ ë‹¤ì‹œ ì„¤ì •í•´ë³´ì„¸ìš”.",
        "ì‘ì€ ë‹¨ìœ„ë¡œ ì¼ì •ì„ ë‚˜ëˆ„ê³ , ì™„ë£Œí•  ë•Œë§ˆë‹¤ ì²´í¬í•˜ëŠ” ìŠµê´€ì„ ë“¤ì—¬ë³´ì„¸ìš”.",
        "ê°€ì¥ ìƒì‚°ì ì¸ ì‹œê°„ëŒ€ë¥¼ ì°¾ì•„ ì¤‘ìš”í•œ ì¼ì„ ê·¸ ì‹œê°„ì— ë°°ì¹˜í•´ë³´ì„¸ìš”.",
        "ì¼ì •ì„ ì™„ë£Œí•˜ì§€ ëª»í–ˆì„ ë•Œì˜ íŒ¨í„´ì„ ë¶„ì„í•´ë³´ì„¸ìš”. ê³µí†µì ì¸ ë°©í•´ ìš”ì†Œê°€ ìˆë‚˜ìš”?",
      ],
    },
    // 30-60%: ìµœì í™” ì¡°ì–¸
    {
      range: [30, 60],
      messages: [
        "ì‹œê°„ ê´€ë¦¬ ê¸°ë²•ì„ ì ìš©í•´ë³´ì„¸ìš”. í¬ëª¨ë„ë¡œ, íƒ€ì„ë¸”ë¡, ì•„ì´ì  í•˜ì›Œ ë§¤íŠ¸ë¦­ìŠ¤ ë“±ì´ ë„ì›€ë  ìˆ˜ ìˆì–´ìš”.",
        "í•  ìˆ˜ ìˆëŠ” ê²ƒê³¼ í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ êµ¬ë¶„í•˜ëŠ” ì—°ìŠµì´ í•„ìš”í•´ìš”. ë¬´ë¦¬í•œ ê³„íšì€ ì˜¤íˆë ¤ ì—­íš¨ê³¼ê°€ ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        "ì™„ë£Œí•œ ì¼ì •ê³¼ ë¯¸ì™„ë£Œí•œ ì¼ì •ì˜ íŠ¹ì„±ì„ ë¹„êµí•´ë³´ì„¸ìš”. ì–´ë–¤ íŒ¨í„´ì´ ìˆë‚˜ìš”?",
        "ì—ë„ˆì§€ ìˆ˜ì¤€ì— ë”°ë¼ ì¼ì •ì„ ë°°ì¹˜í•´ë³´ì„¸ìš”. ì§‘ì¤‘ë ¥ì´ ë†’ì„ ë•Œ ì¤‘ìš”í•œ ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.",
        "ì¼ì •ì„ 50-80% ì •ë„ë§Œ ê³„íší•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ìœ ì—°ì„±ì„ ìœ„í•´ ë¹„ì›Œë‘ëŠ” ë°©ë²•ë„ ìˆì–´ìš”.",
      ],
    },
    // 60-80%: íš¨ìœ¨ í–¥ìƒ ì¡°ì–¸
    {
      range: [60, 80],
      messages: [
        "ì¢‹ì€ ì™„ë£Œìœ¨ì…ë‹ˆë‹¤. ì´ì œ ê° í™œë™ì˜ ì§ˆê³¼ ê¹Šì´ë¥¼ ë†’ì´ëŠ” ë° ì§‘ì¤‘í•´ë³´ì„¸ìš”.",
        "ë£¨í‹´ì„ ì˜ ë”°ë¥´ê³  ìˆêµ°ìš”. ë‹¤ìŒ ë‹¨ê³„ë¡œ ë‚˜ì•„ê°€ê¸° ìœ„í•œ ë„ì „ì  ëª©í‘œë¥¼ í•˜ë‚˜ì”© ì¶”ê°€í•´ë³´ì„¸ìš”.",
        "ì™„ë£Œí•˜ì§€ ëª»í•œ ì¼ì •ì˜ ê³µí†µì ì„ ì°¾ì•„ë³´ì„¸ìš”. íŠ¹ì • ìœ í˜•ì˜ ì¼ì— ì–´ë ¤ì›€ì„ ê²ªê³  ìˆë‚˜ìš”?",
        "ì¢‹ì€ ìŠµê´€ì´ í˜•ì„±ë˜ê³  ìˆì–´ìš”. ì´ë¥¼ ë” ê²¬ê³ í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•œ ì‹œìŠ¤í…œì„ ê³ ë¯¼í•´ë³´ì„¸ìš”.",
        "íš¨ìœ¨ì ì¸ ì¼ì • ê´€ë¦¬ ë°©ì‹ì´ í™•ë¦½ë˜ê³  ìˆì–´ìš”. ì´ì œ ì¼ê³¼ íœ´ì‹ì˜ ê· í˜•ì—ë„ ì£¼ì˜ë¥¼ ê¸°ìš¸ì—¬ë³´ì„¸ìš”.",
      ],
    },
    // 80-100%: ìµœê³  ìˆ˜ì¤€ ìœ ì§€ ë° ë„ì „
    {
      range: [80, 100],
      messages: [
        "íƒì›”í•œ ì¼ì • ê´€ë¦¬ ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆì–´ìš”. ì´ì œ ë” ë„ì „ì ì¸ ëª©í‘œë¥¼ ì„¤ì •í•´ë³´ì„¸ìš”.",
        "ë†’ì€ ì™„ë£Œìœ¨ì„ ìœ ì§€í•˜ê³  ìˆì–´ìš”. ì´ ì‹œìŠ¤í…œì„ ë‹¤ë¥¸ ì˜ì—­ì—ë„ ì ìš©í•´ë³¼ ìˆ˜ ìˆì„ ê±°ì˜ˆìš”.",
        "ì¼ì • ê´€ë¦¬ì— ëŠ¥ìˆ™í•´ì¡Œì–´ìš”. ì´ì œ ê° í™œë™ì˜ ì§ˆì  í–¥ìƒì— ì§‘ì¤‘í•´ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?",
        "ë›°ì–´ë‚œ ì‹¤í–‰ë ¥ì„ ê°–ì¶”ê³  ìˆë„¤ìš”. ì¥ê¸°ì ì¸ ëª©í‘œì™€ ì¼ìƒì˜ í™œë™ì´ ì˜ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ ì ê²€í•´ë³´ì„¸ìš”.",
        "ê±°ì˜ ì™„ë²½í•œ ì¼ì • ê´€ë¦¬ë¥¼ ë³´ì—¬ì£¼ê³  ìˆì–´ìš”. ì§€ì† ê°€ëŠ¥í•œ ë°©ì‹ìœ¼ë¡œ ì´ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
      ],
    },
    // ì¼ì •ì´ ì—†ì„ ë•Œ
    {
      range: [-1, 0],
      messages: [
        "ì´ë²ˆ ì£¼ì—ëŠ” ê³„íšëœ ì¼ì •ì´ ì—†ì—ˆì–´ìš”. ë‹¤ìŒ ì£¼ì—ëŠ” ê°„ë‹¨í•œ ì£¼ê°„ ê³„íšë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.",
        "ê³„íš ì—†ì´ ë³´ë‚¸ ì£¼ê°„ì´ì—ˆë„¤ìš”. ë‹¤ìŒ ì£¼ëŠ” í•µì‹¬ í™œë™ ëª‡ ê°€ì§€ë§Œ ì •í•´ë³´ëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”.",
        "ì²´ê³„ì ì¸ ì¼ì • ê´€ë¦¬ì˜ ì²« ê±¸ìŒì€ ì£¼ê°„ ë‹¨ìœ„ì˜ í° ê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ê²ƒì…ë‹ˆë‹¤. ë‹¤ìŒ ì£¼ë¥¼ ìœ„í•œ ê°„ë‹¨í•œ ë¡œë“œë§µì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.",
        "ì¼ì • ê´€ë¦¬ê°€ ì–´ë µê²Œ ëŠê»´ì§„ë‹¤ë©´, í•˜ë£¨ 3ê°€ì§€ ì¤‘ìš”í•œ ì¼ë§Œ ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”.",
        "ë‹¤ìŒ ì£¼ë¥¼ ìœ„í•œ ì£¼ê°„ í…Œë§ˆë¥¼ ì •í•´ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”? ì˜ˆë¥¼ ë“¤ì–´ 'ê¸°ì´ˆ ë‹¤ì§€ê¸°' ì£¼ê°„ì´ë‚˜ 'ì •ë¦¬ ì£¼ê°„' ë“±ìœ¼ë¡œìš”.",
      ],
    },
  ],

  // ì›”ê°„ ë¦¬í¬íŠ¸ ê¸°ë³¸ í”¼ë“œë°± (íŒ¨í„´ ë¶„ì„)
  monthlyPatterns: [
    // í™œë™ ë¹„ìœ¨ì— ë”°ë¥¸ ë©”ì‹œì§€
    {
      criteria: "activityRatio",
      ranges: [
        {
          range: [0, 30],
          messages: [
            "ì´ë²ˆ ë‹¬ì€ í™œë™ ê¸°ë¡ì´ ë‹¤ì†Œ ì ì—ˆë„¤ìš”. ê¾¸ì¤€í•œ ê¸°ë¡ ìŠµê´€ì„ ë“¤ì´ë©´ ë” ì •í™•í•œ ë¶„ì„ì´ ê°€ëŠ¥í•´ìš”.",
            "í•œ ë‹¬ ì¤‘ ì¼ë¶€ ê¸°ê°„ë§Œ í™œë™ì´ ê¸°ë¡ë˜ì—ˆì–´ìš”. ë” ê·œì¹™ì ì¸ íŒ¨í„´ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.",
            "í™œë™ ê¸°ë¡ì´ ì‚°ë°œì ì´ë„¤ìš”. ê¾¸ì¤€í•œ ë£¨í‹´ì´ ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ê±°ì˜ˆìš”.",
          ],
        },
        {
          range: [30, 70],
          messages: [
            "í•œ ë‹¬ì˜ ì ˆë°˜ ì´ìƒì„ ê¾¸ì¤€íˆ í™œë™í–ˆì–´ìš”. ì¢‹ì€ íŒ¨í„´ì´ í˜•ì„±ë˜ê³  ìˆìŠµë‹ˆë‹¤.",
            "ê¾¸ì¤€í•œ í™œë™ íŒ¨í„´ì´ ë³´ì´ë„¤ìš”. ë¹„í™œë™ ë‚ ì—ëŠ” ì–´ë–¤ ê³µí†µì ì´ ìˆì—ˆëŠ”ì§€ ìƒê°í•´ë³´ì„¸ìš”.",
            "ê·œì¹™ì ì¸ í™œë™ ìŠµê´€ì´ ë§Œë“¤ì–´ì§€ê³  ìˆì–´ìš”. ë” ì¼ê´€ëœ íŒ¨í„´ì„ ìœ„í•´ ë…¸ë ¥í•´ë³´ì„¸ìš”.",
          ],
        },
        {
          range: [70, 100],
          messages: [
            "ë§¤ìš° ê¾¸ì¤€í•œ í™œë™ íŒ¨í„´ì´ ë³´ì…ë‹ˆë‹¤. ë›°ì–´ë‚œ ì§€ì†ë ¥ì„ ê°€ì§€ê³  ìˆë„¤ìš”!",
            "ê±°ì˜ ë§¤ì¼ í™œë™í•˜ëŠ” í›Œë¥­í•œ ìŠµê´€ì´ í˜•ì„±ë˜ì—ˆì–´ìš”. ì´ëŸ° ê¾¸ì¤€í•¨ì´ í° ì„±ì¥ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.",
            "íƒì›”í•œ ì§€ì†ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆì–´ìš”. ì´ëŸ° ê¾¸ì¤€í•¨ì€ ì¥ê¸°ì ìœ¼ë¡œ í° ì°¨ì´ë¥¼ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤.",
          ],
        },
      ],
    },
    // ìš”ì¼ë³„ í™œë™ íŒ¨í„´
    {
      criteria: "dayPattern",
      patterns: [
        {
          pattern: "weekdayActive",
          messages: [
            "í‰ì¼ì— ì£¼ë¡œ í™œë™í•˜ëŠ” íŒ¨í„´ì´ ë³´ì´ë„¤ìš”. ì£¼ë§ì—ë„ ì§§ê²Œë¼ë„ í™œë™í•˜ë©´ ì—°ì†ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆì–´ìš”.",
            "í‰ì¼ ì¤‘ì‹¬ì˜ ê·œì¹™ì ì¸ íŒ¨í„´ì´ í˜•ì„±ë˜ì—ˆì–´ìš”. ì§ì¥ì´ë‚˜ í•™êµ ì¼ì •ê³¼ ì˜ ë§ì¶”ê³  ìˆë„¤ìš”.",
            "í‰ì¼ í™œë™ì´ ì£¼ë¥¼ ì´ë£¨ê³  ìˆì–´ìš”. ìƒí™œ ë¦¬ë“¬ì´ ì•ˆì •ì ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.",
          ],
        },
        {
          pattern: "weekendActive",
          messages: [
            "ì£¼ë§ì— ì§‘ì¤‘ì ìœ¼ë¡œ í™œë™í•˜ëŠ” íŒ¨í„´ì´ë„¤ìš”. í‰ì¼ì—ë„ ì‘ì€ í™œë™ì„ ì¶”ê°€í•˜ë©´ ë” ê· í˜• ì¡í ìˆ˜ ìˆì–´ìš”.",
            "ì£¼ë§ì„ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ê³  ìˆì–´ìš”. ì‹œê°„ì  ì—¬ìœ ê°€ ìˆì„ ë•Œ ì§‘ì¤‘í•˜ëŠ” ì „ëµì´êµ°ìš”.",
            "ì£¼ë§ í™œë™ì´ ë‘ë“œëŸ¬ì§€ë„¤ìš”. í‰ì¼ê³¼ ì£¼ë§ì˜ ê· í˜•ì„ ì¡°ê¸ˆ ë” ë§ì¶°ë³´ëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”.",
          ],
        },
        {
          pattern: "balanced",
          messages: [
            "í‰ì¼ê³¼ ì£¼ë§ì— ê· í˜• ìˆê²Œ í™œë™í•˜ê³  ìˆì–´ìš”. ì•ˆì •ì ì¸ íŒ¨í„´ì´ í˜•ì„±ë˜ì—ˆë„¤ìš”.",
            "ì¼ì£¼ì¼ ë‚´ë‚´ ê¾¸ì¤€í•œ í™œë™ íŒ¨í„´ì„ ë³´ì—¬ì£¼ê³  ìˆì–´ìš”. ê· í˜• ì¡íŒ ìŠµê´€ì´ í˜•ì„±ë˜ì—ˆë„¤ìš”.",
            "ìš”ì¼ì— ê´€ê³„ì—†ì´ ê¾¸ì¤€í•œ í™œë™ì´ ì´ë£¨ì–´ì§€ê³  ìˆì–´ìš”. ë§¤ìš° ì•ˆì •ì ì¸ íŒ¨í„´ì…ë‹ˆë‹¤.",
          ],
        },
      ],
    },
    // ì‹œê°„ëŒ€ë³„ íŒ¨í„´
    {
      criteria: "timeSlot",
      slots: [
        {
          slot: "ì˜¤ì „(6-12ì‹œ)",
          messages: [
            "ì£¼ë¡œ ì˜¤ì „ì— í™œë™í•˜ëŠ” íŒ¨í„´ì´ë„¤ìš”. ì•„ì¹¨ ì‹œê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ê³  ìˆì–´ìš”.",
            "ì˜¤ì „ í™œë™ì´ ë§ë„¤ìš”. ë§ì€ ì‚¬ëŒë“¤ì´ ì˜¤ì „ì— ì§‘ì¤‘ë ¥ì´ ë†’ë‹¤ê³  í•©ë‹ˆë‹¤. ì¢‹ì€ ìŠµê´€ì´ì—ìš”.",
            "ì•„ì¹¨í˜• ì¸ê°„ì´ì‹œêµ°ìš”! ì˜¤ì „ ì‹œê°„ì„ ì˜ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
          ],
        },
        {
          slot: "ì˜¤í›„(12-18ì‹œ)",
          messages: [
            "ì£¼ë¡œ ì˜¤í›„ì— í™œë™í•˜ëŠ” íŒ¨í„´ì´ë„¤ìš”. ì˜¤í›„ ì‹œê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ê³  ìˆì–´ìš”.",
            "ì˜¤í›„ ì‹œê°„ëŒ€ì— ê°€ì¥ í™œë°œí•˜ê²Œ í™œë™í•˜ê³  ìˆì–´ìš”. ìì‹ ì—ê²Œ ë§ëŠ” ë¦¬ë“¬ì„ ì°¾ì€ ê²ƒ ê°™ë„¤ìš”.",
            "ì˜¤í›„ ì‹œê°„ì„ ì£¼ë¡œ í™œìš©í•˜ê³  ìˆì–´ìš”. ìì‹ ì˜ ìƒì²´ë¦¬ë“¬ì— ë§ì¶˜ ì¢‹ì€ ì„ íƒì…ë‹ˆë‹¤.",
          ],
        },
        {
          slot: "ì €ë…(18-24ì‹œ)",
          messages: [
            "ì£¼ë¡œ ì €ë… ì‹œê°„ì— í™œë™í•˜ëŠ” íŒ¨í„´ì´ë„¤ìš”. ì €ë… ì‹œê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ê³  ìˆì–´ìš”.",
            "ì €ë… ì‹œê°„ëŒ€ì— ê°€ì¥ í™œë°œí•˜ê²Œ í™œë™í•˜ê³  ìˆì–´ìš”. ë°¤í˜• ì¸ê°„ì´ì‹œêµ°ìš”!",
            "ì €ë… ì‹œê°„ì„ ì£¼ë¡œ í™œìš©í•˜ê³  ìˆì–´ìš”. í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í•˜ë©° ì§‘ì¤‘í•˜ëŠ” íŒ¨í„´ì´ë„¤ìš”.",
          ],
        },
        {
          slot: "ì•¼ê°„(0-6ì‹œ)",
          messages: [
            "ì•¼ê°„ì— í™œë™í•˜ëŠ” íŒ¨í„´ì´ ë³´ì´ë„¤ìš”. ë³¸ì¸ì—ê²Œ ë§ëŠ” ì‹œê°„ì´ë¼ë©´ ì¢‹ì§€ë§Œ, ìˆ˜ë©´ íŒ¨í„´ì—ë„ ì‹ ê²½ ì¨ì£¼ì„¸ìš”.",
            "ë°¤ ì‹œê°„ì„ ì£¼ë¡œ í™œìš©í•˜ê³  ìˆì–´ìš”. ì§‘ì¤‘ì´ ì˜ ëœë‹¤ë©´ ì¢‹ì§€ë§Œ, ê±´ê°•ë„ í•¨ê»˜ ì±™ê¸°ì„¸ìš”.",
            "ì‹¬ì•¼ ì‹œê°„ëŒ€ì— í™œë™ì´ ì§‘ì¤‘ë˜ì–´ ìˆì–´ìš”. ì¶©ë¶„í•œ íœ´ì‹ê³¼ ìˆ˜ë©´ë„ ìƒì‚°ì„±ì— ì¤‘ìš”í•©ë‹ˆë‹¤.",
          ],
        },
      ],
    },
  ],
};

// í…œí”Œë¦¿ ë©”ì‹œì§€ ëª¨ìŒ (SimpleFeedbackServiceì—ì„œ ê°€ì ¸ì˜¨ ê²ƒ)
const TEMPLATES = {
  // ì¼ê°„ ë¦¬í¬íŠ¸ ì¸ì‚¬ì´íŠ¸ í…œí”Œë¦¿
  DAILY_INSIGHTS: {
    LOW_ACTIVITY: [
      "ì˜¤ëŠ˜ì€ í•™ìŠµ í™œë™ì´ {HOURS}ì‹œê°„ìœ¼ë¡œ ì ì—ˆë„¤ìš”. ë‚´ì¼ì€ ì¡°ê¸ˆ ë” ì‹œê°„ì„ ë‚´ì–´ ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
      "ì˜¤ëŠ˜ì€ {HOURS}ì‹œê°„ì˜ ì§§ì€ í•™ìŠµ ì‹œê°„ì´ì—ˆì§€ë§Œ, ê¾¸ì¤€í•¨ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë‚´ì¼ë„ ê³„ì†í•´ë³´ì„¸ìš”.",
      "ì˜¤ëŠ˜ì€ {HOURS}ì‹œê°„ë§Œ ê³µë¶€í–ˆë„¤ìš”. ë‹¤ë¥¸ ì¼ë¡œ ë°”ë¹´ë‚˜ìš”? ì§§ì€ ì‹œê°„ì´ë¼ë„ í•™ìŠµ ìŠµê´€ì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
    ],
    MEDIUM_ACTIVITY: [
      "ì˜¤ëŠ˜ í•™ìŠµì— {HOURS}ì‹œê°„ì„ íˆ¬ìí–ˆë„¤ìš”. ì¢‹ì€ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•˜ê³  ìˆì–´ìš”!",
      "ì˜¤ëŠ˜ì€ {HOURS}ì‹œê°„ìœ¼ë¡œ ê· í˜• ì¡íŒ í•™ìŠµ ì‹œê°„ì´ì—ˆìŠµë‹ˆë‹¤. ì´ëŒ€ë¡œ ê¾¸ì¤€íˆ ì§„í–‰í•˜ë©´ ì¢‹ì€ ê²°ê³¼ê°€ ìˆì„ ê±°ì˜ˆìš”.",
      "{HOURS}ì‹œê°„ì˜ í•™ìŠµìœ¼ë¡œ ê¾¸ì¤€í•œ í•™ìŠµ ìŠµê´€ì´ í˜•ì„±ë˜ê³  ìˆì–´ìš”. ì´ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•´ë³´ì„¸ìš”.",
    ],
    HIGH_ACTIVITY: [
      "ì˜¤ëŠ˜ì€ {HOURS}ì‹œê°„ ë™ì•ˆ ì •ë§ ì—´ì‹¬íˆ í•™ìŠµí–ˆë„¤ìš”! ì¶©ë¶„í•œ íœ´ì‹ë„ ì±™ê¸°ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”.",
      "{HOURS}ì‹œê°„ì´ë¼ëŠ” ê¸´ ì‹œê°„ ë™ì•ˆ ì§‘ì¤‘ë ¥ì„ ìœ ì§€í–ˆêµ°ìš”. ëŒ€ë‹¨í•©ë‹ˆë‹¤! ì´ëŸ° ë‚ ë“¤ì´ ëª¨ì—¬ í° ì„±ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
      "ì˜¤ëŠ˜ì€ íŠ¹ë³„íˆ í•™ìŠµì— {HOURS}ì‹œê°„ì´ë¼ëŠ” ë§ì€ ì‹œê°„ì„ íˆ¬ìí–ˆë„¤ìš”. ì—´ì •ì´ ë‹ë³´ì…ë‹ˆë‹¤!",
    ],
  },

  // ì™„ë£Œìœ¨ ê¸°ë°˜ ì¶”ì²œ í…œí”Œë¦¿
  RECOMMENDATIONS: {
    LOW_COMPLETION: [
      "ì¼ì • ì™„ë£Œìœ¨ì´ {COMPLETION}%ë¡œ ë‹¤ì†Œ ë‚®ìŠµë‹ˆë‹¤. ë” ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ê³„íší•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
      "ì¼ì •ì˜ {COMPLETION}%ë§Œ ì™„ë£Œí–ˆì–´ìš”. ë‚´ì¼ì€ ê°€ì¥ ì¤‘ìš”í•œ ì¼ 3ê°€ì§€ë§Œ ì„ íƒí•´ì„œ ì§‘ì¤‘í•´ë³´ì„¸ìš”.",
      "ì™„ë£Œìœ¨ì´ {COMPLETION}%ì…ë‹ˆë‹¤. ì‹¤í˜„ ê°€ëŠ¥í•œ ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ìš°ì„ ìˆœìœ„ë¥¼ ì •í•˜ë©´ ì™„ë£Œìœ¨ì„ ë†’ì¼ ìˆ˜ ìˆì–´ìš”.",
    ],
    MEDIUM_COMPLETION: [
      "ì¼ì •ì˜ {COMPLETION}%ë¥¼ ì™„ë£Œí–ˆë„¤ìš”. ë‚¨ì€ ì¼ì •ì— ìš°ì„ ìˆœìœ„ë¥¼ ë‘ê³  ì§‘ì¤‘í•´ë³´ì„¸ìš”.",
      "{COMPLETION}%ì˜ ì™„ë£Œìœ¨ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì‹œê°„ ê´€ë¦¬ê°€ ì ì  ë‚˜ì•„ì§€ê³  ìˆì–´ìš”. ì§‘ì¤‘ì´ ì˜ ë˜ëŠ” ì‹œê°„ëŒ€ì— ì¤‘ìš”í•œ ì¼ì •ì„ ë°°ì¹˜í•´ë³´ì„¸ìš”.",
      "ì¼ì •ì˜ {COMPLETION}%ë¥¼ ì™„ë£Œí–ˆì–´ìš”. ê¾¸ì¤€í•œ ê°œì„ ì´ ì´ë£¨ì–´ì§€ê³  ìˆì–´ìš”. ë‚´ì¼ì€ ì™„ë£Œìœ¨ì„ ë” ë†’ì—¬ë³´ì„¸ìš”.",
    ],
    HIGH_COMPLETION: [
      "ì¼ì •ì˜ {COMPLETION}%ë¥¼ í›Œë¥­í•˜ê²Œ ì™„ë£Œí–ˆì–´ìš”! ë†’ì€ ì‹¤í–‰ë ¥ì„ ìœ ì§€í•˜ê³  ìˆë„¤ìš”.",
      "{COMPLETION}%ë¼ëŠ” ë†’ì€ ì™„ë£Œìœ¨ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì˜¤ëŠ˜ì˜ ì„±ê³µ ìš”ì¸ì„ ìƒê°í•´ë³´ê³ , ì´ë¥¼ ë‚´ì¼ë„ ì ìš©í•´ë³´ì„¸ìš”.",
      "ì¼ì •ì˜ {COMPLETION}%ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ë›°ì–´ë‚œ ì¼ì • ê´€ë¦¬ ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆì–´ìš”. ì´ ìŠµê´€ì„ ê³„ì† ìœ ì§€í•˜ì„¸ìš”!",
    ],
  },

  // ì£¼ê°„ ë¦¬í¬íŠ¸ ì¸ì‚¬ì´íŠ¸ í…œí”Œë¦¿
  WEEKLY_INSIGHTS: {
    LOW_ACTIVITY: [
      "ì´ë²ˆ ì£¼ì—ëŠ” ì´ {HOURS}ì‹œê°„ ê³µë¶€í–ˆì–´ìš”. ë‹¤ìŒ ì£¼ì—ëŠ” ì¡°ê¸ˆì”© í•™ìŠµ ì‹œê°„ì„ ëŠ˜ë ¤ë³´ì„¸ìš”.",
      "ì£¼ê°„ ì´ í•™ìŠµ ì‹œê°„ì´ {HOURS}ì‹œê°„ìœ¼ë¡œ ë‹¤ì†Œ ì ì—ˆì–´ìš”. ë§¤ì¼ ì§§ë”ë¼ë„ ê¾¸ì¤€íˆ ê³µë¶€í•˜ëŠ” ìŠµê´€ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
      "ì´ë²ˆ ì£¼ {HOURS}ì‹œê°„ì˜ í•™ìŠµ ì‹œê°„ì€ ì‹œì‘ì ì´ ë  ìˆ˜ ìˆì–´ìš”. ê¾¸ì¤€í•œ í•™ìŠµ ìŠµê´€ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”.",
    ],
    MEDIUM_ACTIVITY: [
      "ì£¼ë‹¹ {HOURS}ì‹œê°„ ê³µë¶€í–ˆì–´ìš”. ê· í˜• ì¡íŒ í•™ìŠµ íŒ¨í„´ì´ í˜•ì„±ë˜ê³  ìˆìŠµë‹ˆë‹¤.",
      "ì´ë²ˆ ì£¼ ì´ {HOURS}ì‹œê°„ í•™ìŠµí–ˆìŠµë‹ˆë‹¤. ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ë³´ì…ë‹ˆë‹¤. ì´ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•´ë³´ì„¸ìš”.",
      "ì£¼ê°„ {HOURS}ì‹œê°„ì˜ í•™ìŠµìœ¼ë¡œ ì•ˆì •ì ì¸ íŒ¨í„´ì„ ë³´ì—¬ì£¼ê³  ìˆì–´ìš”. ì¢‹ì€ ìŠµê´€ì´ í˜•ì„±ë˜ê³  ìˆìŠµë‹ˆë‹¤.",
    ],
    HIGH_ACTIVITY: [
      "ì´ë²ˆ ì£¼ ì´ {HOURS}ì‹œê°„ì´ë¼ëŠ” ë§ì€ ì‹œê°„ì„ í•™ìŠµì— íˆ¬ìí–ˆë„¤ìš”. ì—´ì •ì´ ë‹ë³´ì…ë‹ˆë‹¤!",
      "{HOURS}ì‹œê°„ì˜ ì£¼ê°„ í•™ìŠµ ì‹œê°„ì€ ë§¤ìš° ì¸ìƒì ì…ë‹ˆë‹¤. ê±´ê°• ê´€ë¦¬ì™€ íœ´ì‹ë„ í•¨ê»˜ ì±™ê¸°ì„¸ìš”.",
      "ì´ë²ˆ ì£¼ì—ëŠ” {HOURS}ì‹œê°„ ë™ì•ˆ ì§‘ì¤‘ì ìœ¼ë¡œ í•™ìŠµí–ˆë„¤ìš”. í›Œë¥­í•œ ë…¸ë ¥ì…ë‹ˆë‹¤!",
    ],
  },

  // ì£¼ê°„ ì¶”ì²œ í…œí”Œë¦¿
  WEEKLY_RECOMMENDATIONS: {
    LOW_COMPLETION: [
      "ì£¼ê°„ ì¼ì • ì™„ë£Œìœ¨ì´ {COMPLETION}%ë¡œ ë‹¤ì†Œ ë‚®ì•˜ì–´ìš”. ë‹¤ìŒ ì£¼ì—ëŠ” ë” í˜„ì‹¤ì ì¸ ëª©í‘œë¥¼ ì„¤ì •í•´ë³´ì„¸ìš”.",
      "ì¼ì • ì™„ë£Œìœ¨ì´ {COMPLETION}%ì…ë‹ˆë‹¤. ì¤‘ìš”í•œ ì‘ì—… ìœ„ì£¼ë¡œ ìš°ì„ ìˆœìœ„ë¥¼ ë‹¤ì‹œ ì„¤ì •í•´ë³´ëŠ” ê²ƒì´ ì¢‹ê² ì–´ìš”.",
      "{COMPLETION}%ì˜ ì™„ë£Œìœ¨ì„ ë³´ì˜€ìŠµë‹ˆë‹¤. ë‹¤ìŒ ì£¼ì—ëŠ” ì¼ì •ì„ ë” ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ê´€ë¦¬í•´ë³´ì„¸ìš”.",
    ],
    MEDIUM_COMPLETION: [
      "ì£¼ê°„ ì¼ì •ì˜ {COMPLETION}%ë¥¼ ì™„ë£Œí–ˆì–´ìš”. ì‹œê°„ ê´€ë¦¬ ê¸°ë²•ì„ í™œìš©í•˜ë©´ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì¼ì •ì„ ì†Œí™”í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”.",
      "{COMPLETION}%ì˜ ì™„ë£Œìœ¨ì€ ê´œì°®ì€ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ì—ë„ˆì§€ ìˆ˜ì¤€ì— ë”°ë¼ ì¼ì •ì„ ë°°ì¹˜í•´ë³´ì„¸ìš”.",
      "ì¼ì •ì˜ {COMPLETION}%ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ì™„ë£Œí•˜ì§€ ëª»í•œ ì¼ì •ì˜ ê³µí†µì ì„ ì°¾ì•„ ê°œì„ í•´ë³´ì„¸ìš”.",
    ],
    HIGH_COMPLETION: [
      "ì£¼ê°„ ì¼ì •ì˜ {COMPLETION}%ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí–ˆì–´ìš”! ì´ëŸ¬í•œ ë†’ì€ ì‹¤í–‰ë ¥ì„ ìœ ì§€í•˜ì„¸ìš”.",
      "{COMPLETION}%ë¼ëŠ” í›Œë¥­í•œ ì™„ë£Œìœ¨ì„ ë³´ì˜€ìŠµë‹ˆë‹¤. ì´ì œ ê° í™œë™ì˜ ì§ˆì  í–¥ìƒì— ì§‘ì¤‘í•´ë³´ì„¸ìš”.",
      "ì¼ì •ì˜ {COMPLETION}%ë¥¼ ì™„ë£Œí–ˆì–´ìš”. íƒì›”í•œ ì¼ì • ê´€ë¦¬ ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤!",
    ],
  },

  // ì›”ê°„ ë¦¬í¬íŠ¸ ì¸ì‚¬ì´íŠ¸ í…œí”Œë¦¿
  MONTHLY_INSIGHTS: {
    LOW_ACTIVITY: [
      "ì´ë²ˆ ë‹¬ì—ëŠ” ì´ {HOURS}ì‹œê°„ ê³µë¶€í–ˆì–´ìš”. í™œë™ ì¼ìˆ˜ëŠ” {DAYS}ì¼({RATIO}%)ì´ì—ˆìŠµë‹ˆë‹¤. ì¡°ê¸ˆì”© í™œë™ ì¼ìˆ˜ë¥¼ ëŠ˜ë ¤ë³´ì„¸ìš”.",
      "ì›”ê°„ ì´ í•™ìŠµ ì‹œê°„ì´ {HOURS}ì‹œê°„ìœ¼ë¡œ í™œë™ ë¹„ìœ¨ì€ {RATIO}%ì˜€ì–´ìš”. ê¾¸ì¤€í•œ ìŠµê´€ì„ í˜•ì„±í•˜ëŠ” ë° ì§‘ì¤‘í•´ë³´ì„¸ìš”.",
      "ì´ë²ˆ ë‹¬ì—ëŠ” {DAYS}ì¼ ë™ì•ˆ ì´ {HOURS}ì‹œê°„ í•™ìŠµí–ˆì–´ìš”. ë‹¤ìŒ ë‹¬ì—ëŠ” ë” ê·œì¹™ì ì¸ íŒ¨í„´ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.",
    ],
    MEDIUM_ACTIVITY: [
      "ì´ë²ˆ ë‹¬ì—ëŠ” ì´ {HOURS}ì‹œê°„ì„ {DAYS}ì¼({RATIO}%) ë™ì•ˆ í•™ìŠµí–ˆì–´ìš”. ì•ˆì •ì ì¸ íŒ¨í„´ì´ í˜•ì„±ë˜ê³  ìˆì–´ìš”.",
      "ì›”ê°„ ì´ {HOURS}ì‹œê°„, {DAYS}ì¼({RATIO}%)ì˜ í™œë™ì„ ë³´ì˜€ì–´ìš”. ê· í˜• ì¡íŒ í•™ìŠµì´ ì´ë£¨ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤.",
      "ì´ë²ˆ ë‹¬ì—ëŠ” {DAYS}ì¼({RATIO}%) ë™ì•ˆ ì´ {HOURS}ì‹œê°„ í•™ìŠµí–ˆì–´ìš”. ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ë‹ë³´ì…ë‹ˆë‹¤.",
    ],
    HIGH_ACTIVITY: [
      "ì´ë²ˆ ë‹¬ì—ëŠ” {DAYS}ì¼({RATIO}%)ì´ë¼ëŠ” ë†’ì€ í™œë™ ë¹„ìœ¨ë¡œ ì´ {HOURS}ì‹œê°„ í•™ìŠµí–ˆì–´ìš”. ëŒ€ë‹¨í•©ë‹ˆë‹¤!",
      "ì›”ê°„ ì´ {HOURS}ì‹œê°„, {RATIO}%ì˜ í™œë™ ë¹„ìœ¨ì„ ë³´ì˜€ì–´ìš”. ë§¤ìš° ì—´ì •ì ìœ¼ë¡œ í•™ìŠµì— ì„í•˜ê³  ìˆë„¤ìš”!",
      "ì´ë²ˆ ë‹¬ì—ëŠ” {DAYS}ì¼({RATIO}%)ì— ê±¸ì³ ì´ {HOURS}ì‹œê°„ í•™ìŠµí–ˆì–´ìš”. íƒì›”í•œ ê¾¸ì¤€í•¨ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤!",
    ],
  },
};

// ëœë¤ ë©”ì‹œì§€ ì„ íƒ í•¨ìˆ˜
export const getRandomMessage = (messageArray) => {
  const randomIndex = Math.floor(Math.random() * messageArray.length);
  return messageArray[randomIndex];
};

// ìƒí™©ì— ë§ëŠ” ë©”ì‹œì§€ ì„ íƒ í•¨ìˆ˜
export const getContextualMessage = (category, value) => {
  // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ë©”ì‹œì§€ ë°°ì—´ ì°¾ê¸°
  const messageCategory = FEEDBACK_MESSAGES[category];
  if (!messageCategory) return "ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.";

  // ë²”ìœ„ì— ë§ëŠ” ë©”ì‹œì§€ ê·¸ë£¹ ì°¾ê¸°
  let selectedGroup;

  if (value === 0 || value === null || value === undefined) {
    // ê¸°ë¡ì´ ì—†ëŠ” ê²½ìš°
    selectedGroup = messageCategory.find((group) => group.range[0] === -1);
  } else {
    // ê°’ì— ë§ëŠ” ë²”ìœ„ ì°¾ê¸°
    selectedGroup = messageCategory.find(
      (group) => value >= group.range[0] && value < group.range[1]
    );
  }

  if (!selectedGroup) return "ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.";

  // í•´ë‹¹ ê·¸ë£¹ì—ì„œ ëœë¤ ë©”ì‹œì§€ ì„ íƒ
  return getRandomMessage(selectedGroup.messages);
};

// íŒ¨í„´ ê¸°ë°˜ ë©”ì‹œì§€ ì„ íƒ í•¨ìˆ˜
export const getPatternMessage = (patternType, pattern) => {
  const patternCategory = FEEDBACK_MESSAGES.monthlyPatterns.find(
    (cat) => cat.criteria === patternType
  );

  if (!patternCategory) return "íŒ¨í„´ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.";

  let selectedPattern;

  if (patternType === "activityRatio") {
    // í™œë™ ë¹„ìœ¨ ê¸°ë°˜ ë©”ì‹œì§€
    selectedPattern = patternCategory.ranges.find(
      (range) => pattern >= range.range[0] && pattern < range.range[1]
    );
  } else if (patternType === "dayPattern") {
    // ìš”ì¼ íŒ¨í„´ ê¸°ë°˜ ë©”ì‹œì§€
    selectedPattern = patternCategory.patterns.find(
      (pat) => pat.pattern === pattern
    );
  } else if (patternType === "timeSlot") {
    // ì‹œê°„ëŒ€ ê¸°ë°˜ ë©”ì‹œì§€
    selectedPattern = patternCategory.slots.find(
      (slot) => slot.slot === pattern
    );
  }

  if (!selectedPattern) return "íŒ¨í„´ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.";

  return getRandomMessage(selectedPattern.messages);
};

// ì¡°ê±´ì— ë”°ë¥¸ í…œí”Œë¦¿ ì„ íƒ í•¨ìˆ˜ (SimpleFeedbackService)
const selectTemplate = (category, data) => {
  // ì¹´í…Œê³ ë¦¬ë³„ ë‹¤ë¥¸ ì¡°ê±´ ê²€ì‚¬
  let templateArray;

  if (category === "DAILY_INSIGHTS") {
    const { totalHours } = data;
    if (totalHours >= 5) {
      templateArray = TEMPLATES.DAILY_INSIGHTS.HIGH_ACTIVITY;
    } else if (totalHours >= 2) {
      templateArray = TEMPLATES.DAILY_INSIGHTS.MEDIUM_ACTIVITY;
    } else {
      templateArray = TEMPLATES.DAILY_INSIGHTS.LOW_ACTIVITY;
    }
  } else if (category === "RECOMMENDATIONS") {
    const { completionRate } = data;
    if (completionRate >= 75) {
      templateArray = TEMPLATES.RECOMMENDATIONS.HIGH_COMPLETION;
    } else if (completionRate >= 40) {
      templateArray = TEMPLATES.RECOMMENDATIONS.MEDIUM_COMPLETION;
    } else {
      templateArray = TEMPLATES.RECOMMENDATIONS.LOW_COMPLETION;
    }
  } else if (category === "WEEKLY_INSIGHTS") {
    const { totalHours } = data;
    if (totalHours >= 15) {
      templateArray = TEMPLATES.WEEKLY_INSIGHTS.HIGH_ACTIVITY;
    } else if (totalHours >= 7) {
      templateArray = TEMPLATES.WEEKLY_INSIGHTS.MEDIUM_ACTIVITY;
    } else {
      templateArray = TEMPLATES.WEEKLY_INSIGHTS.LOW_ACTIVITY;
    }
  } else if (category === "WEEKLY_RECOMMENDATIONS") {
    const { completionRate } = data;
    if (completionRate >= 75) {
      templateArray = TEMPLATES.WEEKLY_RECOMMENDATIONS.HIGH_COMPLETION;
    } else if (completionRate >= 40) {
      templateArray = TEMPLATES.WEEKLY_RECOMMENDATIONS.MEDIUM_COMPLETION;
    } else {
      templateArray = TEMPLATES.WEEKLY_RECOMMENDATIONS.LOW_COMPLETION;
    }
  } else if (category === "MONTHLY_INSIGHTS") {
    const { totalHours, activityRatio } = data;
    if (activityRatio >= 70) {
      templateArray = TEMPLATES.MONTHLY_INSIGHTS.HIGH_ACTIVITY;
    } else if (activityRatio >= 40) {
      templateArray = TEMPLATES.MONTHLY_INSIGHTS.MEDIUM_ACTIVITY;
    } else {
      templateArray = TEMPLATES.MONTHLY_INSIGHTS.LOW_ACTIVITY;
    }
  } else {
    // ê¸°ë³¸ê°’
    return "ë°ì´í„° ë¶„ì„ ì¤‘...";
  }

  // ëœë¤í•˜ê²Œ í•˜ë‚˜ ì„ íƒ
  return templateArray[Math.floor(Math.random() * templateArray.length)];
};

// í…œí”Œë¦¿ì— ë°ì´í„° ì ìš© í•¨ìˆ˜ (SimpleFeedbackService)
const applyTemplate = (template, data) => {
  // ë³€ìˆ˜ ì¹˜í™˜ (ì˜ˆ: {HOURS} -> data.totalHours)
  let result = template;

  // ëª¨ë“  {KEY} í˜•íƒœì˜ ë¬¸ìì—´ì„ data ê°ì²´ì˜ ê°’ìœ¼ë¡œ ëŒ€ì²´
  const placeholders = template.match(/\{([A-Z_]+)\}/g) || [];

  placeholders.forEach((placeholder) => {
    const key = placeholder.replace(/[{}]/g, "");
    const value = data[key] || "";
    result = result.replace(placeholder, value);
  });

  return result;
};

// ì¸ê³µì  ì§€ì—° í•¨ìˆ˜ (SimpleFeedbackService)
export const simulateProcessing = (callback, progressCallback) => {
  // ë‹¨ê³„ë³„ ë©”ì‹œì§€
  const steps = [
    { message: "ë°ì´í„° ë¡œë”© ì¤‘...", duration: 500 },
    { message: "ë°ì´í„° ë¶„ì„ ì¤‘...", duration: 700 },
    { message: "íŒ¨í„´ ì¸ì‹ ì¤‘...", duration: 600 },
    { message: "ì¸ì‚¬ì´íŠ¸ ìƒì„± ì¤‘...", duration: 500 },
    { message: "ê²°ê³¼ ìµœì í™” ì¤‘...", duration: 400 },
  ];

  let currentStep = 0;

  // ì²« ë²ˆì§¸ ë‹¨ê³„ ì‹œì‘
  if (progressCallback) {
    progressCallback(steps[0].message, 0);
  }

  // ë‹¨ê³„ë³„ ì§€ì—° ì²˜ë¦¬
  const processStep = () => {
    currentStep++;

    if (currentStep < steps.length) {
      // ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
      if (progressCallback) {
        progressCallback(
          steps[currentStep].message,
          (currentStep / steps.length) * 100
        );
      }

      setTimeout(processStep, steps[currentStep].duration);
    } else {
      // ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ
      if (progressCallback) {
        progressCallback("ë¶„ì„ ì™„ë£Œ!", 100);
      }

      // ì•½ê°„ì˜ ì§€ì—° í›„ ìµœì¢… ì½œë°± ì‹¤í–‰
      setTimeout(() => {
        if (callback) callback();
      }, 300);
    }
  };

  // ì²« ë²ˆì§¸ ë‹¨ê³„ ì´í›„ ì§„í–‰
  setTimeout(processStep, steps[0].duration);
};

// 4. ëª©í‘œ ì²˜ë¦¬ í•¨ìˆ˜ ê°œì„ 
export const processGoalsForReport = (goalTargets) => {
  try {
    if (
      !goalTargets ||
      !Array.isArray(goalTargets) ||
      goalTargets.length === 0
    ) {
      return {
        hasGoals: false,
        hasActiveGoals: false,
        message:
          "ì•„ì§ ì„¤ì •ëœ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤. ëª©í‘œë¥¼ ì„¤ì •í•˜ë©´ ë” ì²´ê³„ì ì¸ ë¶„ì„ì„ ì œê³µí•´ë“œë¦½ë‹ˆë‹¤.",
        analysis: null,
        goals: [],
        activeGoals: [],
        urgentGoals: [],
        todayGoals: [],
        overallStatus: "ëª©í‘œë¥¼ ì„¤ì •í•´ë³´ì„¸ìš”.",
      };
    }

    console.log(`ëª©í‘œ ${goalTargets.length}ê°œ ì²˜ë¦¬ ì¤‘...`);

    const today = new Date();
    today.setHours(0, 0, 0, 0);

    // ëª©í‘œ ì¹´í…Œê³ ë¦¬ë³„ ê¶Œì¥ ì¼ì¼ í•™ìŠµ ì‹œê°„ (ì‹œê°„) - map ë°–ìœ¼ë¡œ ì´ë™
    const recommendedDailyHours = {
      ì‹œí—˜: 4,
      ìê²©ì¦: 3,
      ì–´í•™: 2,
      í”„ë¡œì íŠ¸: 3,
      ì·¨ì—…ì¤€ë¹„: 4,
      ê¸°íƒ€: 2,
    };

    // ëª©í‘œ ì²˜ë¦¬ ë¡œì§
    const processedGoals = goalTargets.map((goal) => {
      const targetDate = new Date(goal.targetDate);
      targetDate.setHours(0, 0, 0, 0);
      const daysLeft = differenceInDays(targetDate, today);

      // D-Day í…ìŠ¤íŠ¸ ìƒì„±
      let dDayText = "";
      if (daysLeft === 0) {
        dDayText = "D-Day";
      } else if (daysLeft > 0) {
        dDayText = `D-${daysLeft}`;
      } else {
        dDayText = `D+${Math.abs(daysLeft)}`;
      }

      const category = goal.category || "ê¸°íƒ€";
      const dailyTarget = recommendedDailyHours[category] || 2;

      // ê¸´ê¸‰ë„ ë° ìš°ì„ ìˆœìœ„ ê³„ì‚°
      let urgencyLevel = "ì—¬ìœ ";
      let urgencyColor = "#50cebb";
      let priorityAdvice = "";

      if (daysLeft <= 0) {
        urgencyLevel = "ì™„ë£Œ/ë§ˆê°";
        urgencyColor = "#888888";
        priorityAdvice =
          daysLeft === 0 ? "ì˜¤ëŠ˜ì´ ëª©í‘œì¼ì…ë‹ˆë‹¤!" : "ëª©í‘œ ë‚ ì§œê°€ ì§€ë‚¬ìŠµë‹ˆë‹¤.";
      } else if (daysLeft <= 3) {
        urgencyLevel = "ë§¤ìš°ê¸´ê¸‰";
        urgencyColor = "#FF4444";
        priorityAdvice = `ë§ˆì§€ë§‰ ìŠ¤í¼íŠ¸! í•˜ë£¨ ${
          dailyTarget + 1
        }ì‹œê°„ì”© ì§‘ì¤‘í•˜ì„¸ìš”.`;
      } else if (daysLeft <= 7) {
        urgencyLevel = "ê¸´ê¸‰";
        urgencyColor = "#FF8800";
        priorityAdvice = `ì¼ì£¼ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤. í•˜ë£¨ ${dailyTarget}ì‹œê°„ì”© ê¾¸ì¤€íˆ!`;
      } else if (daysLeft <= 14) {
        urgencyLevel = "ì£¼ì˜";
        urgencyColor = "#FFAA00";
        priorityAdvice = `2ì£¼ ê³„íšìœ¼ë¡œ í•˜ë£¨ ${dailyTarget}ì‹œê°„ì”© ì²´ê³„ì ìœ¼ë¡œ ì¤€ë¹„í•˜ì„¸ìš”.`;
      } else if (daysLeft <= 30) {
        urgencyLevel = "ë³´í†µ";
        urgencyColor = "#FFD700";
        priorityAdvice = `í•œ ë‹¬ ì—¬ìœ ê°€ ìˆìŠµë‹ˆë‹¤. ê¾¸ì¤€íˆ í•˜ë£¨ ${dailyTarget}ì‹œê°„ì”© ì§„í–‰í•˜ì„¸ìš”.`;
      } else {
        urgencyLevel = "ì—¬ìœ ";
        urgencyColor = "#50cebb";
        priorityAdvice = `ì¶©ë¶„í•œ ì‹œê°„ì´ ìˆìŠµë‹ˆë‹¤. í•˜ë£¨ ${Math.max(
          dailyTarget - 1,
          1
        )}ì‹œê°„ì”© ì—¬ìœ ìˆê²Œ ì¤€ë¹„í•˜ì„¸ìš”.`;
      }

      // ëª©í‘œ ìœ í˜•ë³„ êµ¬ì²´ì ì¸ ì¡°ì–¸
      let typeSpecificAdvice = "";
      if (goal.category === "ì‹œí—˜") {
        typeSpecificAdvice = "ê¸°ì¶œë¬¸ì œ í’€ì´ì™€ ì˜¤ë‹µë…¸íŠ¸ ì •ë¦¬ì— ì§‘ì¤‘í•˜ì„¸ìš”.";
      } else if (goal.category === "ìê²©ì¦") {
        typeSpecificAdvice = "ì´ë¡  í•™ìŠµê³¼ ì‹¤ìŠµì„ ë³‘í–‰í•˜ì—¬ ì§„í–‰í•˜ì„¸ìš”.";
      } else if (goal.category === "ì–´í•™") {
        typeSpecificAdvice = "ë“£ê¸°, ë§í•˜ê¸°, ì½ê¸°, ì“°ê¸°ë¥¼ ê³¨ê³ ë£¨ ì—°ìŠµí•˜ì„¸ìš”.";
      } else if (goal.category === "í”„ë¡œì íŠ¸") {
        typeSpecificAdvice =
          "ë‹¨ê³„ë³„ ë§ˆì¼ìŠ¤í†¤ì„ ì„¤ì •í•˜ê³  ì§„í–‰ìƒí™©ì„ ì²´í¬í•˜ì„¸ìš”.";
      } else if (goal.category === "ì·¨ì—…ì¤€ë¹„") {
        typeSpecificAdvice =
          "í¬íŠ¸í´ë¦¬ì˜¤, ìê¸°ì†Œê°œì„œ, ë©´ì ‘ ì¤€ë¹„ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ì§„í–‰í•˜ì„¸ìš”.";
      }

      // return ë¬¸ì„ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ë°°ì¹˜
      return {
        ...goal,
        daysLeft,
        dDayText,
        urgencyLevel,
        urgencyColor,
        dailyTargetHours: dailyTarget,
        priorityAdvice,
        typeSpecificAdvice,
        isOverdue: daysLeft < 0,
        isToday: daysLeft === 0,
        isUrgent: daysLeft <= 7 && daysLeft > 0,
      };
    }); // map í•¨ìˆ˜ ì¢…ë£Œ

    // í™œì„± ëª©í‘œ í•„í„°ë§
    const activeGoals = processedGoals.filter((goal) => goal.daysLeft >= 0);
    const urgentGoals = activeGoals.filter((goal) => goal.isUrgent);
    const todayGoals = processedGoals.filter((goal) => goal.isToday);

    // ë¶„ì„ ê²°ê³¼ êµ¬ì„±
    const analysis =
      activeGoals.length > 0
        ? {
            totalActiveGoals: activeGoals.length,
            urgentGoalsCount: urgentGoals.length,
            todayGoalsCount: todayGoals.length,
            totalDailyTarget: activeGoals.reduce(
              (sum, goal) => sum + goal.dailyTargetHours,
              0
            ),
            averageDaysLeft: Math.round(
              activeGoals.reduce((sum, goal) => sum + goal.daysLeft, 0) /
                activeGoals.length
            ),
            mostUrgentGoal: activeGoals.sort(
              (a, b) => a.daysLeft - b.daysLeft
            )[0],
            longestGoal: activeGoals.sort((a, b) => b.daysLeft - a.daysLeft)[0],
          }
        : null;

    // ì „ì²´ ìƒíƒœ ë©”ì‹œì§€ ìƒì„±
    let overallStatus = "";
    if (todayGoals.length > 0) {
      overallStatus = `ğŸ¯ ì˜¤ëŠ˜ì´ ${todayGoals.length}ê°œ ëª©í‘œì˜ D-Dayì…ë‹ˆë‹¤!`;
    } else if (urgentGoals.length > 0) {
      overallStatus = `âš ï¸ ${urgentGoals.length}ê°œì˜ ê¸´ê¸‰í•œ ëª©í‘œê°€ ìˆìŠµë‹ˆë‹¤. ìš°ì„ ìˆœìœ„ë¥¼ ì •í•´ ì§‘ì¤‘í•˜ì„¸ìš”!`;
    } else if (analysis?.totalDailyTarget > 6) {
      overallStatus = `ğŸ“š ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ í•˜ë£¨ ${analysis.totalDailyTarget}ì‹œê°„ í•™ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.`;
    } else if (activeGoals.length > 0) {
      overallStatus = `âœ… ê¾¸ì¤€íˆ í•˜ë£¨ ${
        analysis?.totalDailyTarget || 0
      }ì‹œê°„ë§Œ íˆ¬ìí•˜ë©´ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
    } else {
      overallStatus = `âœ¨ ëª¨ë“  ëª©í‘œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ëª©í‘œë¥¼ ì„¤ì •í•´ë³´ì„¸ìš”!`;
    }

    const result = {
      hasGoals: processedGoals.length > 0,
      hasActiveGoals: activeGoals.length > 0,
      overallStatus,
      analysis,
      goals: processedGoals,
      activeGoals,
      urgentGoals,
      todayGoals,
      message: overallStatus,
    };

    console.log("ëª©í‘œ ì²˜ë¦¬ ì™„ë£Œ:", {
      totalGoals: processedGoals.length,
      activeGoals: activeGoals.length,
      urgentGoals: urgentGoals.length,
      todayGoals: todayGoals.length,
    });

    return result;
  } catch (error) {
    console.error("ëª©í‘œ ì²˜ë¦¬ ì˜¤ë¥˜:", error);
    return {
      hasGoals: false,
      hasActiveGoals: false,
      message: "ëª©í‘œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      analysis: null,
      goals: [],
      activeGoals: [],
      urgentGoals: [],
      todayGoals: [],
      overallStatus: "ëª©í‘œ ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.",
    };
  }
};

// ì¼ê°„ ë¦¬í¬íŠ¸ ìƒì„± í•¨ìˆ˜
const generateDailyReport = (date, data) => {
  const { studySessions = {}, tasks = {}, goalTargets = [] } = data;

  // 1. í•´ë‹¹ ë‚ ì§œì˜ ê³µë¶€ ì„¸ì…˜ ì¶”ì¶œ
  const todaySessions = studySessions[date] || [];

  // 2. ì´ ê³µë¶€ ì‹œê°„ ê³„ì‚°
  const totalStudyTime = todaySessions.reduce(
    (sum, session) => sum + (session.duration || 0),
    0
  );
  const totalHours = Math.round((totalStudyTime / 3600) * 10) / 10; // ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€

  // 3. ê°€ì¥ ìƒì‚°ì ì¸ ì‹œê°„ëŒ€ ì°¾ê¸°
  let mostProductiveHour = null;
  let maxDuration = 0;

  // ì‹œê°„ë³„ ê³µë¶€ ì‹œê°„ ì§‘ê³„
  const hourlyStudy = {};

  todaySessions.forEach((session) => {
    if (session.timestamp) {
      const sessionTime = new Date(session.timestamp);
      const hour = sessionTime.getHours();

      hourlyStudy[hour] = (hourlyStudy[hour] || 0) + (session.duration || 0);

      if (hourlyStudy[hour] > maxDuration) {
        maxDuration = hourlyStudy[hour];
        mostProductiveHour = hour;
      }
    }
  });

  // 4. ì¼ì • ì™„ë£Œìœ¨ ê³„ì‚°
  const todayTasks = tasks[date] || {};
  const taskCount = Object.keys(todayTasks).length;
  const completedCount = Object.values(todayTasks).filter(Boolean).length;
  const completionRate =
    taskCount > 0 ? Math.round((completedCount / taskCount) * 100) : 0;

  // 5. ê³¼ëª©ë³„ ê³µë¶€ ì‹œê°„ ë¶„ì„
  const subjectAnalysis = {};
  todaySessions.forEach((session) => {
    const subject = session.subject || "ê¸°íƒ€";
    subjectAnalysis[subject] =
      (subjectAnalysis[subject] || 0) + (session.duration || 0);
  });

  // 6. ëª©í‘œ ì²˜ë¦¬ - í–¥ìƒëœ ë¶„ì„
  const goalsAnalysis = processGoalsForReport(goalTargets);

  // 7. ëª©í‘œ ê¸°ë°˜ í•™ìŠµ íš¨ìœ¨ì„± ë¶„ì„
  let goalProgressAnalysis = "ëª©í‘œ ì •ë³´ê°€ ì—†ì–´ ì¼ë°˜ì ì¸ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.";
  let todayTargetHours = 0;
  let progressRate = 0;

  if (goalsAnalysis.hasActiveGoals) {
    todayTargetHours = goalsAnalysis.analysis.totalDailyTarget;
    progressRate =
      todayTargetHours > 0
        ? Math.round((totalHours / todayTargetHours) * 100)
        : 0;

    if (goalsAnalysis.todayGoals.length > 0) {
      goalProgressAnalysis = `ğŸ¯ ì˜¤ëŠ˜ì€ ${goalsAnalysis.todayGoals.length}ê°œ ëª©í‘œì˜ D-Dayì…ë‹ˆë‹¤! ìµœì„ ì„ ë‹¤í•˜ì„¸ìš”.`;
    } else if (goalsAnalysis.urgentGoals.length > 0) {
      goalProgressAnalysis = `âš ï¸ ${goalsAnalysis.urgentGoals.length}ê°œì˜ ê¸´ê¸‰í•œ ëª©í‘œê°€ ìˆìŠµë‹ˆë‹¤. ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ í•˜ë£¨ ${todayTargetHours}ì‹œê°„ í•™ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.`;
    } else {
      goalProgressAnalysis = `ğŸ“ˆ ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ í•˜ë£¨ ${todayTargetHours}ì‹œê°„ í•™ìŠµì´ ê¶Œì¥ë©ë‹ˆë‹¤.`;
    }

    // ì§„í–‰ë¥ ì— ë”°ë¥¸ ì¶”ê°€ ë¶„ì„
    if (progressRate >= 100) {
      goalProgressAnalysis += ` ì˜¤ëŠ˜ ëª©í‘œ í•™ìŠµëŸ‰ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! (${progressRate}%)`;
    } else if (progressRate >= 70) {
      goalProgressAnalysis += ` ëª©í‘œì— ê±°ì˜ ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. (${progressRate}%)`;
    } else if (progressRate >= 30) {
      goalProgressAnalysis += ` ëª©í‘œì˜ ${progressRate}% ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤. ì¡°ê¸ˆ ë” ë…¸ë ¥í•´ë³´ì„¸ìš”.`;
    } else if (totalHours > 0) {
      goalProgressAnalysis += ` ëª©í‘œ ëŒ€ë¹„ ${progressRate}% ì§„í–‰í–ˆìŠµë‹ˆë‹¤. ë‚´ì¼ì€ ë” ì§‘ì¤‘í•´ë³´ì„¸ìš”.`;
    } else {
      goalProgressAnalysis +=
        " ì•„ì§ í•™ìŠµì„ ì‹œì‘í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‘ì€ ê²ƒë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.";
    }
  }

  // 8. í–¥ìƒëœ í…œí”Œë¦¿ ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸ ìƒì„±
  const insightData = {
    totalHours,
    completionRate,
    progressRate,
    todayTargetHours,
  };
  const insightTemplate = selectTemplate("DAILY_INSIGHTS", insightData);
  const recommendationTemplate = selectTemplate("RECOMMENDATIONS", insightData);

  const insights = applyTemplate(insightTemplate, {
    HOURS: totalHours.toString(),
    COMPLETION: completionRate.toString(),
  });

  // ëª©í‘œ ê¸°ë°˜ ì¶”ì²œ ì‚¬í•­ ìƒì„±
  let goalBasedRecommendations = "";
  if (goalsAnalysis.hasActiveGoals && totalHours < todayTargetHours) {
    const remainingHours = todayTargetHours - totalHours;
    goalBasedRecommendations = `ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ${remainingHours.toFixed(
      1
    )}ì‹œê°„ ë” í•™ìŠµí•˜ì„¸ìš”. `;

    if (goalsAnalysis.urgentGoals.length > 0) {
      const urgentGoal = goalsAnalysis.urgentGoals[0];
      goalBasedRecommendations += `íŠ¹íˆ "${urgentGoal.title}" (${urgentGoal.dDayText})ì— ì§‘ì¤‘í•˜ì„¸ìš”.`;
    }
  }

  const recommendations =
    applyTemplate(recommendationTemplate, {
      HOURS: totalHours.toString(),
      COMPLETION: completionRate.toString(),
    }) +
    " " +
    goalBasedRecommendations;

  // 9. ìµœì¢… ë¦¬í¬íŠ¸ ê°ì²´ ë°˜í™˜ - í–¥ìƒëœ ì •ë³´ í¬í•¨
  return {
    type: REPORT_TYPES.DAILY,
    date,
    timestamp: new Date().toISOString(),
    totalHours,
    completionRate,
    mostProductiveTime:
      mostProductiveHour !== null ? `${mostProductiveHour}ì‹œ` : "N/A",
    subjectAnalysis,
    // ê¸°ì¡´ ëª©í‘œ ì •ë³´ (í˜¸í™˜ì„±)
    upcomingGoalsInfo: goalsAnalysis.goals || [],
    // ìƒˆë¡œìš´ í–¥ìƒëœ ëª©í‘œ ë¶„ì„
    goalsAnalysis,
    goalProgressAnalysis,
    todayTargetHours,
    progressRate,
    insights,
    recommendations,
    // ì¶”ê°€ ë¶„ì„ ì •ë³´
    hourlyStudy,
    taskAnalysis: {
      total: taskCount,
      completed: completedCount,
      remaining: taskCount - completedCount,
    },
    isAIGenerated: false, // ê¸°ë³¸ì€ AI ìƒì„± ì•„ë‹˜
  };
};

// ì£¼ê°„ ë¦¬í¬íŠ¸ ìƒì„± í•¨ìˆ˜
const generateWeeklyReport = (date, data) => {
  const {
    studySessions = {},
    tasks = {},
    schedules = {},
    goalTargets = [],
  } = data;

  // 1. ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
  const currentDate = new Date(date);
  const weekStart = startOfWeek(currentDate, { weekStartsOn: 1 }); // ì›”ìš”ì¼ ì‹œì‘
  const weekEnd = endOfWeek(currentDate, { weekStartsOn: 1 }); // ì¼ìš”ì¼ ë

  const startDateStr = format(weekStart, "yyyy-MM-dd");
  const endDateStr = format(weekEnd, "yyyy-MM-dd");

  // 2. ì£¼ê°„ ë‚ ì§œ ë°°ì—´ ìƒì„±
  const dateArray = [];
  let currentDay = new Date(weekStart);
  while (currentDay <= weekEnd) {
    dateArray.push(format(currentDay, "yyyy-MM-dd"));
    currentDay.setDate(currentDay.getDate() + 1);
  }

  // 3. ì£¼ê°„ ë°ì´í„° ìˆ˜ì§‘
  let totalStudyTime = 0;
  let totalTasks = 0;
  let completedTasks = 0;
  let mostStudyDay = null;
  let maxDayStudy = 0;

  const subjectAnalysis = {};
  const dailyStudyTime = {};
  const dailyCompletionRate = {};

  // ìš”ì¼ë³„ ì¼ì • ë¶„í¬
  const schedulesByDay = { ì›”: 0, í™”: 0, ìˆ˜: 0, ëª©: 0, ê¸ˆ: 0, í† : 0, ì¼: 0 };

  // ì¼ì • ìœ í˜•ë³„ ê°œìˆ˜
  const scheduleTypeCount = { í•™ìŠµ: 0, ì—…ë¬´: 0, íšŒì˜: 0, ê°œì¸: 0, ê¸°íƒ€: 0 };

  // 4. ë‚ ì§œë³„ ì§‘ê³„
  dateArray.forEach((dayStr) => {
    // ê³µë¶€ ì„¸ì…˜ ë¶„ì„
    const daySessions = studySessions[dayStr] || [];
    const dayStudyTime = daySessions.reduce(
      (sum, session) => sum + (session.duration || 0),
      0
    );

    totalStudyTime += dayStudyTime;
    dailyStudyTime[dayStr] = dayStudyTime;

    // ê°€ì¥ ê³µë¶€ë¥¼ ë§ì´ í•œ ë‚  ì²´í¬
    if (dayStudyTime > maxDayStudy) {
      maxDayStudy = dayStudyTime;
      mostStudyDay = dayStr;
    }

    // ê³¼ëª©ë³„ ë¶„ì„
    daySessions.forEach((session) => {
      const subject = session.subject || "ê¸°íƒ€";
      subjectAnalysis[subject] =
        (subjectAnalysis[subject] || 0) + (session.duration || 0);
    });

    // ì¼ì • ì™„ë£Œìœ¨ ë¶„ì„
    const dayTasks = tasks[dayStr] || {};
    const dayTaskCount = Object.keys(dayTasks).length;
    const dayCompletedCount = Object.values(dayTasks).filter(Boolean).length;

    totalTasks += dayTaskCount;
    completedTasks += dayCompletedCount;

    // ë‚ ì§œë³„ ì™„ë£Œìœ¨ ì €ì¥
    dailyCompletionRate[dayStr] =
      dayTaskCount > 0
        ? Math.round((dayCompletedCount / dayTaskCount) * 100)
        : 0;

    // ìš”ì¼ë³„ ì¼ì • ìˆ˜ ì§‘ê³„
    const daySchedules = schedules[dayStr] || [];
    const dayDate = new Date(dayStr);
    const dayIndex = dayDate.getDay(); // 0: ì¼ìš”ì¼, 1: ì›”ìš”ì¼, ...
    const koreanDays = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
    const dayName = koreanDays[dayIndex];

    schedulesByDay[dayName] += daySchedules.length;

    // ì¼ì • ìœ í˜•ë³„ ê°œìˆ˜ ì§‘ê³„
    daySchedules.forEach((schedule) => {
      const type = schedule.type || "ê¸°íƒ€";
      if (scheduleTypeCount[type] !== undefined) {
        scheduleTypeCount[type]++;
      } else {
        scheduleTypeCount["ê¸°íƒ€"]++;
      }
    });
  });

  // 5. ì´ê³„ ê³„ì‚°
  const totalHours = Math.round((totalStudyTime / 3600) * 10) / 10;
  const avgDailyHours = Math.round((totalStudyTime / 3600 / 7) * 10) / 10;
  const completionRate =
    totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

  // 6. ëª©í‘œ ì •ë³´ ì²˜ë¦¬ - í–¥ìƒëœ ë¶„ì„
  const goalsAnalysis = processGoalsForReport(goalTargets);

  // 7. ì£¼ê°„ ëª©í‘œ ì§„í–‰ë¥  ë¶„ì„
  let weeklyGoalAnalysis = "ëª©í‘œ ì •ë³´ê°€ ì—†ì–´ ì¼ë°˜ì ì¸ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.";
  let weeklyTargetHours = 0;
  let weeklyProgressRate = 0;

  if (goalsAnalysis.hasActiveGoals) {
    weeklyTargetHours = goalsAnalysis.analysis.totalDailyTarget * 7; // ì£¼ê°„ ëª©í‘œ
    weeklyProgressRate =
      weeklyTargetHours > 0
        ? Math.round((totalHours / weeklyTargetHours) * 100)
        : 0;

    // ì´ë²ˆ ì£¼ì— D-Dayì¸ ëª©í‘œë“¤
    const thisWeekGoals = goalsAnalysis.activeGoals.filter(
      (goal) => goal.daysLeft <= 7
    );

    if (thisWeekGoals.length > 0) {
      weeklyGoalAnalysis = `ğŸ”¥ ì´ë²ˆ ì£¼ì— ${thisWeekGoals.length}ê°œ ëª©í‘œì˜ ë§ˆê°ì´ ìˆìŠµë‹ˆë‹¤! `;
      weeklyGoalAnalysis += thisWeekGoals
        .map((goal) => `"${goal.title}" (${goal.dDayText})`)
        .join(", ");
    } else if (goalsAnalysis.urgentGoals.length > 0) {
      weeklyGoalAnalysis = `âš ï¸ ${goalsAnalysis.urgentGoals.length}ê°œì˜ ê¸´ê¸‰ ëª©í‘œê°€ ìˆìŠµë‹ˆë‹¤. ì£¼ê°„ ëª©í‘œ í•™ìŠµëŸ‰: ${weeklyTargetHours}ì‹œê°„`;
    } else {
      weeklyGoalAnalysis = `ğŸ“… ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì£¼ê°„ ê¶Œì¥ í•™ìŠµëŸ‰: ${weeklyTargetHours}ì‹œê°„`;
    }

    // ì£¼ê°„ ì§„í–‰ë¥  ë¶„ì„
    if (weeklyProgressRate >= 100) {
      weeklyGoalAnalysis += ` ì´ë²ˆ ì£¼ ëª©í‘œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! (${weeklyProgressRate}%)`;
    } else if (weeklyProgressRate >= 70) {
      weeklyGoalAnalysis += ` ì£¼ê°„ ëª©í‘œì— ê±°ì˜ ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. (${weeklyProgressRate}%)`;
    } else if (weeklyProgressRate >= 30) {
      weeklyGoalAnalysis += ` ì£¼ê°„ ëª©í‘œì˜ ${weeklyProgressRate}% ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.`;
    } else {
      weeklyGoalAnalysis += ` ì£¼ê°„ ëª©í‘œ ëŒ€ë¹„ ${weeklyProgressRate}% ì§„í–‰í–ˆìŠµë‹ˆë‹¤. ë‚¨ì€ ìš”ì¼ì— ë” ì§‘ì¤‘í•´ë³´ì„¸ìš”.`;
    }
  }

  // 8. í…œí”Œë¦¿ ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸ ìƒì„± - ëª©í‘œ ì •ë³´ í¬í•¨
  const insightData = {
    totalHours,
    completionRate,
    weeklyProgressRate,
    weeklyTargetHours,
  };
  const insightTemplate = selectTemplate("WEEKLY_INSIGHTS", insightData);
  const recommendationTemplate = selectTemplate(
    "WEEKLY_RECOMMENDATIONS",
    insightData
  );

  const insights = applyTemplate(insightTemplate, {
    HOURS: totalHours.toString(),
    COMPLETION: completionRate.toString(),
  });

  // ëª©í‘œ ê¸°ë°˜ ì£¼ê°„ ì¶”ì²œì‚¬í•­ ìƒì„±
  let weeklyGoalRecommendations = "";
  if (goalsAnalysis.hasActiveGoals) {
    if (weeklyTargetHours > totalHours) {
      const remainingHours = weeklyTargetHours - totalHours;
      weeklyGoalRecommendations = `ë‹¤ìŒ ì£¼ê¹Œì§€ ${remainingHours.toFixed(
        1
      )}ì‹œê°„ ë” í•™ìŠµí•˜ì—¬ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì„¸ìš”. `;
    }

    if (goalsAnalysis.urgentGoals.length > 0) {
      weeklyGoalRecommendations += `ê¸´ê¸‰í•œ ëª©í‘œë“¤ì— ìš°ì„ ìˆœìœ„ë¥¼ ë‘ì„¸ìš”: ${goalsAnalysis.urgentGoals
        .map((g) => g.title)
        .join(", ")}`;
    }
  }

  const recommendations =
    applyTemplate(recommendationTemplate, {
      HOURS: totalHours.toString(),
      COMPLETION: completionRate.toString(),
    }) +
    " " +
    weeklyGoalRecommendations;

  // 9. ì£¼ê°„ í…Œë§ˆì™€ ì§‘ì¤‘ ì˜ì—­ ìƒì„± (ëª©í‘œ ê¸°ë°˜ ê°œì„ )
  let weeklyTheme = "ê¾¸ì¤€í•¨ì˜ ê°€ì¹˜";
  let focusAdvice = "ì‹œê°„ ê´€ë¦¬ì™€ ì§‘ì¤‘ë ¥ í–¥ìƒì— ì§‘ì¤‘í•´ë³´ì„¸ìš”";

  if (totalHours < 7) {
    weeklyTheme = "ì²« ê±¸ìŒì˜ ì¤‘ìš”ì„±";
    focusAdvice = "í•™ìŠµ ìŠµê´€ í˜•ì„±ì— ì§‘ì¤‘í•´ë³´ì„¸ìš”";
  } else if (totalHours < 15) {
    weeklyTheme = "ê¾¸ì¤€í•¨ì˜ í˜";
    focusAdvice = "í•™ìŠµ ì‹œê°„ì„ ì¡°ê¸ˆì”© ëŠ˜ë ¤ë³´ì„¸ìš”";
  } else if (totalHours < 25) {
    weeklyTheme = "ê¹Šì´ ìˆëŠ” ì„±ì¥";
    focusAdvice = "í•™ìŠµì˜ ì§ˆê³¼ ê¹Šì´ì— ì§‘ì¤‘í•´ë³´ì„¸ìš”";
  } else {
    weeklyTheme = "ê· í˜• ìˆëŠ” ë°œì „";
    focusAdvice = "í•™ìŠµê³¼ íœ´ì‹ì˜ ê· í˜•ì„ ìœ ì§€í•˜ì„¸ìš”";
  }

  // 9. ì¼ì • ì¸ì‚¬ì´íŠ¸ ìƒì„±
  let scheduleInsights = "";
  const weekdaySchedules =
    schedulesByDay.ì›” +
    schedulesByDay.í™” +
    schedulesByDay.ìˆ˜ +
    schedulesByDay.ëª© +
    schedulesByDay.ê¸ˆ;
  const weekendSchedules = schedulesByDay.í†  + schedulesByDay.ì¼;

  if (weekdaySchedules === 0 && weekendSchedules === 0) {
    scheduleInsights =
      "ì´ë²ˆ ì£¼ì—ëŠ” ê¸°ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. ê³„íšì ì¸ ì¼ì • ê´€ë¦¬ê°€ ìƒì‚°ì„± í–¥ìƒì— ë„ì›€ì´ ë©ë‹ˆë‹¤.";
  } else if (weekdaySchedules > weekendSchedules * 3) {
    scheduleInsights =
      "í‰ì¼ì— ì¼ì •ì´ ì§‘ì¤‘ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì£¼ë§ì—ë„ ì ì ˆí•œ í™œë™ì„ ë°°ì¹˜í•˜ë©´ ì—°ì†ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
  } else if (weekendSchedules > weekdaySchedules) {
    scheduleInsights =
      "ì£¼ë§ì— ì¼ì •ì´ ì§‘ì¤‘ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í‰ì¼ì—ë„ ì¼ì •ì„ ë¶„ì‚°í•˜ë©´ ë¶€ë‹´ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
  } else {
    scheduleInsights =
      "í‰ì¼ê³¼ ì£¼ë§ì— ê· í˜• ìˆê²Œ ì¼ì •ì´ ë°°ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¢‹ì€ íŒ¨í„´ì…ë‹ˆë‹¤.";
  }

  // ì£¼ìš” ì¼ì • ìœ í˜•ì— ëŒ€í•œ ì¸ì‚¬ì´íŠ¸ ì¶”ê°€
  const mainScheduleType = Object.entries(scheduleTypeCount)
    .sort((a, b) => b[1] - a[1])
    .filter(([_, count]) => count > 0)[0];

  if (mainScheduleType) {
    scheduleInsights += ` ì£¼ë¡œ ${mainScheduleType[0]} ìœ í˜•ì˜ ì¼ì •ì´ ë§ì•˜ìŠµë‹ˆë‹¤.`;
  }

  // 10. ìµœì¢… ë¦¬í¬íŠ¸ ê°ì²´ ë°˜í™˜ - í–¥ìƒëœ ëª©í‘œ ë¶„ì„ í¬í•¨
  return {
    type: REPORT_TYPES.WEEKLY,
    startDate: startDateStr,
    endDate: endDateStr,
    timestamp: new Date().toISOString(),
    totalHours,
    avgDailyHours,
    completionRate,
    mostProductiveDay: mostStudyDay,
    subjectAnalysis,
    dailyStudyTime,
    dailyCompletionRate,
    schedulesByDay,
    scheduleTypeCount,
    // ê¸°ì¡´ ëª©í‘œ ì •ë³´ (í˜¸í™˜ì„±)
    upcomingGoalsInfo: goalsAnalysis.goals || [],
    // ìƒˆë¡œìš´ í–¥ìƒëœ ëª©í‘œ ë¶„ì„
    goalsAnalysis,
    weeklyGoalAnalysis,
    weeklyTargetHours,
    weeklyProgressRate,
    insights,
    recommendations,
    weeklyTheme,
    focusAdvice,
    scheduleInsights,
    isAIGenerated: false,
  };
};

// ì›”ê°„ ë¦¬í¬íŠ¸ ìƒì„± í•¨ìˆ˜
const generateMonthlyReport = (date, data) => {
  const {
    studySessions = {},
    tasks = {},
    schedules = {},
    goalTargets = [],
  } = data;

  // 1. ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
  const currentDate = new Date(date);
  const monthStart = startOfMonth(currentDate);
  const monthEnd = endOfMonth(currentDate);

  const startDateStr = format(monthStart, "yyyy-MM-dd");
  const endDateStr = format(monthEnd, "yyyy-MM-dd");

  // 2. ì›”ê°„ ë‚ ì§œ ë°°ì—´ ìƒì„±
  const dateArray = [];
  let currentDay = new Date(monthStart);
  while (currentDay <= monthEnd) {
    dateArray.push(format(currentDay, "yyyy-MM-dd"));
    currentDay.setDate(currentDay.getDate() + 1);
  }

  // 3. ì›”ê°„ ë°ì´í„° ìˆ˜ì§‘
  let totalStudyTime = 0;
  let totalTasks = 0;
  let completedTasks = 0;
  let daysWithActivity = 0;

  const subjectAnalysis = {};
  const dailyStudyTime = {};

  // ìš”ì¼ë³„ ì¼ì • ë¶„í¬
  const schedulesByDay = { ì›”: 0, í™”: 0, ìˆ˜: 0, ëª©: 0, ê¸ˆ: 0, í† : 0, ì¼: 0 };

  // ì‹œê°„ëŒ€ë³„ ì¼ì • ë¶„í¬
  const schedulesByTimeSlot = {
    "ì˜¤ì „(6-12ì‹œ)": 0,
    "ì˜¤í›„(12-18ì‹œ)": 0,
    "ì €ë…(18-24ì‹œ)": 0,
    "ì•¼ê°„(0-6ì‹œ)": 0,
  };

  // ìì£¼ ë°˜ë³µë˜ëŠ” ì¼ì • ì§‘ê³„
  const taskFrequency = {};

  // 4. ë‚ ì§œë³„ ì§‘ê³„
  dateArray.forEach((dayStr) => {
    // ê³µë¶€ ì„¸ì…˜ ë¶„ì„
    const daySessions = studySessions[dayStr] || [];
    const dayStudyTime = daySessions.reduce(
      (sum, session) => sum + (session.duration || 0),
      0
    );

    // í™œë™ ì¼ìˆ˜ ê³„ì‚°
    if (
      dayStudyTime > 0 ||
      (schedules[dayStr] && schedules[dayStr].length > 0)
    ) {
      daysWithActivity++;
    }

    totalStudyTime += dayStudyTime;
    dailyStudyTime[dayStr] = dayStudyTime;

    // ê³¼ëª©ë³„ ë¶„ì„
    daySessions.forEach((session) => {
      const subject = session.subject || "ê¸°íƒ€";
      subjectAnalysis[subject] =
        (subjectAnalysis[subject] || 0) + (session.duration || 0);
    });

    // ì¼ì • ì™„ë£Œìœ¨ ë¶„ì„
    const dayTasks = tasks[dayStr] || {};
    const dayTaskCount = Object.keys(dayTasks).length;
    const dayCompletedCount = Object.values(dayTasks).filter(Boolean).length;

    totalTasks += dayTaskCount;
    completedTasks += dayCompletedCount;

    // ìš”ì¼ë³„ ì¼ì • ìˆ˜ ì§‘ê³„
    const daySchedules = schedules[dayStr] || [];
    const dayDate = new Date(dayStr);
    const dayIndex = dayDate.getDay(); // 0: ì¼ìš”ì¼, 1: ì›”ìš”ì¼, ...
    const koreanDays = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
    const dayName = koreanDays[dayIndex];

    schedulesByDay[dayName] += daySchedules.length;

    // ì‹œê°„ëŒ€ë³„ ì¼ì • ë¶„í¬ ê³„ì‚°
    daySchedules.forEach((schedule) => {
      if (schedule.startTime) {
        const hour = parseInt(schedule.startTime.split(":")[0]);

        let timeSlot = "";
        if (hour >= 6 && hour < 12) timeSlot = "ì˜¤ì „(6-12ì‹œ)";
        else if (hour >= 12 && hour < 18) timeSlot = "ì˜¤í›„(12-18ì‹œ)";
        else if (hour >= 18 && hour < 24) timeSlot = "ì €ë…(18-24ì‹œ)";
        else timeSlot = "ì•¼ê°„(0-6ì‹œ)";

        schedulesByTimeSlot[timeSlot]++;
      }

      // ì¼ì • ë¹ˆë„ ê³„ì‚°
      if (schedule.task) {
        taskFrequency[schedule.task] = (taskFrequency[schedule.task] || 0) + 1;
      }
    });
  });

  // 5. ì´ê³„ ê³„ì‚°
  const daysInMonth = dateArray.length;
  const totalHours = Math.round((totalStudyTime / 3600) * 10) / 10;
  const avgDailyHours =
    daysWithActivity > 0
      ? Math.round((totalStudyTime / 3600 / daysWithActivity) * 10) / 10
      : 0;
  const completionRate =
    totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
  const activityRatio = Math.round((daysWithActivity / daysInMonth) * 100);

  // ìì£¼ ë°˜ë³µë˜ëŠ” ì¼ì • ì •ë ¬
  const frequentTasks = Object.entries(taskFrequency)
    .filter(([_, count]) => count > 1)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5)
    .map(([task, count]) => ({ task, count }));

  // 6. ëª©í‘œ ì •ë³´ ì²˜ë¦¬ - í–¥ìƒëœ ë¶„ì„
  const goalsAnalysis = processGoalsForReport(goalTargets);

  // 7. ì›”ê°„ ëª©í‘œ ì§„í–‰ë¥  ë¶„ì„
  let monthlyGoalAnalysis = "ëª©í‘œ ì •ë³´ê°€ ì—†ì–´ ì¼ë°˜ì ì¸ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.";
  let monthlyTargetHours = 0;
  let monthlyProgressRate = 0;

  if (goalsAnalysis.hasActiveGoals) {
    monthlyTargetHours = goalsAnalysis.analysis.totalDailyTarget * daysInMonth; // ì›”ê°„ ëª©í‘œ
    monthlyProgressRate =
      monthlyTargetHours > 0
        ? Math.round((totalHours / monthlyTargetHours) * 100)
        : 0;

    // ì´ë²ˆ ë‹¬ì— D-Dayì¸ ëª©í‘œë“¤
    const thisMonthGoals = goalsAnalysis.activeGoals.filter(
      (goal) => goal.daysLeft <= 30
    );
    const completedThisMonth = goalsAnalysis.goals.filter(
      (goal) => goal.isOverdue && goal.daysLeft >= -30
    );

    if (thisMonthGoals.length > 0) {
      monthlyGoalAnalysis = `ğŸ¯ ì´ë²ˆ ë‹¬ì— ${thisMonthGoals.length}ê°œ ëª©í‘œì˜ ë§ˆê°ì´ ìˆìŠµë‹ˆë‹¤. `;
      if (completedThisMonth.length > 0) {
        monthlyGoalAnalysis += `ì´ë¯¸ ${completedThisMonth.length}ê°œ ëª©í‘œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! `;
      }
    } else if (goalsAnalysis.urgentGoals.length > 0) {
      monthlyGoalAnalysis = `ğŸ“‹ ${goalsAnalysis.urgentGoals.length}ê°œì˜ ëª©í‘œê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ì›”ê°„ ëª©í‘œ í•™ìŠµëŸ‰: ${monthlyTargetHours}ì‹œê°„`;
    } else {
      monthlyGoalAnalysis = `ğŸ“… ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì›”ê°„ ê¶Œì¥ í•™ìŠµëŸ‰: ${monthlyTargetHours}ì‹œê°„`;
    }

    // ì›”ê°„ ì§„í–‰ë¥  ë¶„ì„
    if (monthlyProgressRate >= 100) {
      monthlyGoalAnalysis += ` ì´ë²ˆ ë‹¬ ëª©í‘œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! (${monthlyProgressRate}%)`;
    } else if (monthlyProgressRate >= 70) {
      monthlyGoalAnalysis += ` ì›”ê°„ ëª©í‘œì— ê±°ì˜ ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. (${monthlyProgressRate}%)`;
    } else if (monthlyProgressRate >= 30) {
      monthlyGoalAnalysis += ` ì›”ê°„ ëª©í‘œì˜ ${monthlyProgressRate}% ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.`;
    } else {
      monthlyGoalAnalysis += ` ì›”ê°„ ëª©í‘œ ëŒ€ë¹„ ${monthlyProgressRate}% ì§„í–‰í–ˆìŠµë‹ˆë‹¤.`;
    }
  }

  // 8. í…œí”Œë¦¿ ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸ ìƒì„± - ëª©í‘œ ì •ë³´ í¬í•¨
  const insightData = {
    totalHours,
    completionRate,
    activityRatio,
    monthlyProgressRate,
    monthlyTargetHours,
    DAYS: daysWithActivity.toString(),
    RATIO: activityRatio.toString(),
  };

  const insightTemplate = selectTemplate("MONTHLY_INSIGHTS", insightData);

  const insights = applyTemplate(insightTemplate, {
    HOURS: totalHours.toString(),
    DAYS: daysWithActivity.toString(),
    RATIO: activityRatio.toString(),
  });

  // 8. ìƒì‚°ì„± ì ìˆ˜ ê³„ì‚° (ë‹¨ìˆœ ì•Œê³ ë¦¬ì¦˜)
  // í™œë™ ë¹„ìœ¨ 30%, ì™„ë£Œìœ¨ 40%, í‰ê·  í•™ìŠµ ì‹œê°„ 30%
  const activityScore = Math.min(activityRatio, 100) * 0.3;
  const completionScore = Math.min(completionRate, 100) * 0.4;
  const studyScore = Math.min(avgDailyHours * 30, 100) * 0.3;
  const productivityScore = Math.round(
    activityScore + completionScore + studyScore
  );

  // 9. íŒ¨í„´ ë¶„ì„ ë©”ì‹œì§€ ìƒì„±
  // ìš”ì¼ íŒ¨í„´ ë¶„ì„
  let dayPattern = "balanced";
  const weekdayActivity =
    schedulesByDay["ì›”"] +
    schedulesByDay["í™”"] +
    schedulesByDay["ìˆ˜"] +
    schedulesByDay["ëª©"] +
    schedulesByDay["ê¸ˆ"];
  const weekendActivity = schedulesByDay["í† "] + schedulesByDay["ì¼"];

  if (weekdayActivity > weekendActivity * 2) {
    dayPattern = "weekdayActive";
  } else if (weekendActivity > weekdayActivity) {
    dayPattern = "weekendActive";
  }

  // ì‹œê°„ëŒ€ íŒ¨í„´ ì°¾ê¸°
  const mostActiveTimeSlot = Object.entries(schedulesByTimeSlot)
    .sort((a, b) => b[1] - a[1])
    .filter(([_, count]) => count > 0)[0];

  // íŒ¨í„´ ë©”ì‹œì§€ ìƒì„±
  const activityMessage = getPatternMessage("activityRatio", activityRatio);
  const dayPatternMessage = getPatternMessage("dayPattern", dayPattern);
  const timeSlotMessage = mostActiveTimeSlot
    ? getPatternMessage("timeSlot", mostActiveTimeSlot[0])
    : "íŠ¹ì • ì‹œê°„ëŒ€ì— ì§‘ì¤‘ëœ í™œë™ íŒ¨í„´ì€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.";

  // íŒ¨í„´ ì¸ì‚¬ì´íŠ¸ ì¡°í•©
  const schedulePatternInsights = `${activityMessage} ${dayPatternMessage} ${timeSlotMessage}`;

  // 10. ì›”ê°„ í…Œë§ˆì™€ ë‹¤ìŒ ì›” ì§‘ì¤‘ í¬ì¸íŠ¸ ìƒì„±
  let monthlyTheme = "ì„±ì¥ì˜ ì—¬ì •";
  let nextMonthFocus = "ê· í˜• ìˆëŠ” í•™ìŠµ ê³„íš ìˆ˜ë¦½í•˜ê¸°";

  if (activityRatio < 30) {
    monthlyTheme = "ìƒˆë¡œìš´ ì‹œì‘";
    nextMonthFocus = "ê¾¸ì¤€í•œ í•™ìŠµ ìŠµê´€ ë§Œë“¤ê¸°";
  } else if (activityRatio < 60) {
    monthlyTheme = "ë°œì „ê³¼ ë„ì „";
    nextMonthFocus = "í•™ìŠµ ì‹œê°„ ëŠ˜ë¦¬ê¸°";
  } else if (completionRate < 50) {
    monthlyTheme = "ì²´ê³„ì ì¸ ì„±ì¥";
    nextMonthFocus = "ì¼ì • ê´€ë¦¬ ê°œì„ í•˜ê¸°";
  } else if (totalHours < 30) {
    monthlyTheme = "ê¾¸ì¤€í•¨ì˜ í˜";
    nextMonthFocus = "í•™ìŠµ ì‹œê°„ íš¨ìœ¨í™”í•˜ê¸°";
  } else {
    monthlyTheme = "ê· í˜• ìˆëŠ” ì„±ì·¨";
    nextMonthFocus = "ê¹Šì´ ìˆëŠ” í•™ìŠµ ê²½í—˜ ë§Œë“¤ê¸°";
  }

  // 11. ì¥ê¸° ì¶”ì²œ ë©”ì‹œì§€ ìƒì„±
  let longTermRecommendations = "";
  if (activityRatio < 50) {
    longTermRecommendations =
      "ê¾¸ì¤€í•œ í•™ìŠµì„ ìœ„í•´ ë§¤ì¼ ì¡°ê¸ˆì”©ì´ë¼ë„ ê³µë¶€í•˜ëŠ” ìŠµê´€ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”. ìŠµê´€ í˜•ì„±ì´ ì¥ê¸°ì ì¸ ì„±ê³¼ì˜ ì—´ì‡ ì…ë‹ˆë‹¤.";
  } else if (avgDailyHours < 2) {
    longTermRecommendations =
      "í•™ìŠµì˜ ì§ˆì„ ë†’ì´ê¸° ìœ„í•´ ì§‘ì¤‘ ì‹œê°„ì„ ì¡°ê¸ˆì”© ëŠ˜ë ¤ë³´ì„¸ìš”. í•˜ë£¨ 2-3ì‹œê°„ì˜ ì§‘ì¤‘ëœ í•™ìŠµì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.";
  } else if (completionRate < 70) {
    longTermRecommendations =
      "ì¼ì • ê´€ë¦¬ ëŠ¥ë ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ë” ì‹¤í˜„ ê°€ëŠ¥í•œ ëª©í‘œë¥¼ ì„¸ìš°ê³ , í•˜ë£¨ì˜ ìš°ì„ ìˆœìœ„ë¥¼ ì •í•´ë³´ì„¸ìš”.";
  } else {
    longTermRecommendations =
      "í˜„ì¬ í•™ìŠµ íŒ¨í„´ì´ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤. ì´ í˜ì´ìŠ¤ë¥¼ ìœ ì§€í•˜ë˜, í•™ìŠµ ë‚´ìš©ì˜ ë‹¤ì–‘ì„±ê³¼ ê¹Šì´ë¥¼ ë”í•´ë³´ì„¸ìš”.";
  }

  // 12. ì›”ê°„ ê°œìš” ìƒì„±
  const monthlyOverview = `${format(
    monthStart,
    "yyyyë…„ MMì›”"
  )}ì—ëŠ” ì´ ${totalHours}ì‹œê°„ ê³µë¶€í–ˆìœ¼ë©°, í•œ ë‹¬ ì¤‘ ${daysWithActivity}ì¼ (${activityRatio}%) í™œë™í–ˆìŠµë‹ˆë‹¤. ${
    totalHours > 0
      ? `ì£¼ìš” í•™ìŠµ ë¶„ì•¼ëŠ” ${
          Object.entries(subjectAnalysis).sort((a, b) => b[1] - a[1])[0]?.[0] ||
          "ì—†ìŒ"
        }ì˜€ìŠµë‹ˆë‹¤.`
      : ""
  }`;

  // 13. ìµœì¢… ë¦¬í¬íŠ¸ ê°ì²´ ë°˜í™˜ - í–¥ìƒëœ ëª©í‘œ ë¶„ì„ í¬í•¨
  return {
    type: REPORT_TYPES.MONTHLY,
    month: format(monthStart, "yyyyë…„ MMì›”"),
    startDate: startDateStr,
    endDate: endDateStr,
    timestamp: new Date().toISOString(),
    totalHours,
    avgDailyHours,
    completionRate,
    daysWithStudy: daysWithActivity,
    activityRatio,
    subjectAnalysis,
    dailyStudyTime,
    schedulesByDay,
    schedulesByTimeSlot,
    frequentTasks,
    // ê¸°ì¡´ ëª©í‘œ ì •ë³´ (í˜¸í™˜ì„±)
    upcomingGoalsInfo: goalsAnalysis.goals || [],
    // ìƒˆë¡œìš´ í–¥ìƒëœ ëª©í‘œ ë¶„ì„
    goalsAnalysis,
    monthlyGoalAnalysis,
    monthlyTargetHours,
    monthlyProgressRate,
    insights,
    monthlyOverview,
    longTermRecommendations,
    monthlyTheme,
    nextMonthFocus,
    schedulePatternInsights,
    productivityScore,
    isAIGenerated: false,
  };
};

// 1. generateFeedback í•¨ìˆ˜ íŒŒë¼ë¯¸í„° ê°œì„ 
export const generateFeedback = async (
  date,
  reportType,
  schedules,
  tasks,
  studySessions,
  statsData, // ì „ì²´ í†µê³„ ë°ì´í„° ê°ì²´
  useAI = false,
  isPremiumUser = false,
  goalTargets = []
) => {
  try {
    // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ ì¶”ê°€
    if (!date || !reportType) {
      throw new Error("ë‚ ì§œì™€ ë¦¬í¬íŠ¸ íƒ€ì…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
    }

    // ë°ì´í„° ê°ì²´ êµ¬ì„± - ë” ì™„ì „í•˜ê²Œ
    const data = {
      schedules: schedules || {},
      tasks: tasks || {},
      studySessions: studySessions || {},
      goalTargets: goalTargets || [],
      weeklyStats: statsData?.weeklyStats || {},
      monthlyStats: statsData?.monthlyStats || {},
      dailyStats: statsData?.dailyStats || {},
      isPremiumUser,
      generatedAt: new Date().toISOString(),
    };

    // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
    console.log(`generateFeedback í˜¸ì¶œë¨:`, {
      date,
      reportType,
      useAI,
      isPremiumUser,
      dataKeys: Object.keys(data),
      schedulesCount: Object.keys(data.schedules).length,
      tasksCount: Object.keys(data.tasks).length,
      studySessionsCount: Object.keys(data.studySessions).length,
      goalTargetsCount: data.goalTargets.length,
    });

    // generateReport í•¨ìˆ˜ í˜¸ì¶œ
    const report = await generateReport(date, reportType, data, useAI);

    // í”„ë¦¬ë¯¸ì—„ ì‚¬ìš©ì ì •ë³´ ì¶”ê°€
    if (report) {
      report.isPremiumUser = isPremiumUser;
      report.dataCompleteness = calculateDataCompleteness(data);
    }

    return report;
  } catch (error) {
    console.error(`í”¼ë“œë°± ìƒì„± ì˜¤ë¥˜(${reportType}):`, error);
    return null;
  }
};

// ê¸°ì¡´ generateFeedback í•¨ìˆ˜ ëì— ì¶”ê°€
export const generateAIFeedbackWithDeepSeek = async (
  date,
  reportType,
  schedules,
  tasks,
  studySessions,
  statsData,
  useAI = false,
  goalTargets = []
) => {
  try {
    // ê¸°ë³¸ ë¦¬í¬íŠ¸ ìƒì„±
    const baseReport = await generateFeedback(
      date,
      reportType,
      schedules,
      tasks,
      studySessions,
      statsData,
      false, // AI ì‚¬ìš© ì•ˆí•¨
      true, // ì „ì²´ ë¬´ë£Œì´ë¯€ë¡œ í•­ìƒ true
      goalTargets
    );

    // AI ë¶„ì„ ì¶”ê°€ (AI ì‚¬ìš© ìš”ì²­ì‹œ - êµ¬ë…ì ì²´í¬ ì œê±°)
    if (useAI) {
      console.log("ğŸ¤– AI ë¶„ì„ ì¶”ê°€ ì¤‘...");
      const aiResult = await testDeepSeekAPI(reportType);

      if (aiResult.success) {
        baseReport.aiAnalysis = aiResult.data.analysis;
        baseReport.aiRecommendations = aiResult.data.recommendations;
        baseReport.aiInsights = aiResult.data.insights;
        baseReport.aiFocusAreas = aiResult.data.focus_areas;
        baseReport.aiMetadata = aiResult.data.metadata;
        baseReport.isAIEnhanced = true;
      } else {
        baseReport.aiError = aiResult.error;
        baseReport.aiFallback = aiResult.fallback;
      }
    }

    return baseReport;
  } catch (error) {
    console.error("AI í”¼ë“œë°± ìƒì„± ì˜¤ë¥˜:", error);
    return baseReport; // ê¸°ë³¸ ë¦¬í¬íŠ¸ë¼ë„ ë°˜í™˜
  }
};

// 2. ë°ì´í„° ì™„ì„±ë„ ê³„ì‚° í•¨ìˆ˜ ì¶”ê°€
const calculateDataCompleteness = (data) => {
  const scores = {
    schedules: Object.keys(data.schedules).length > 0 ? 1 : 0,
    tasks: Object.keys(data.tasks).length > 0 ? 1 : 0,
    studySessions: Object.keys(data.studySessions).length > 0 ? 1 : 0,
    goalTargets: data.goalTargets.length > 0 ? 1 : 0,
    weeklyStats: Object.keys(data.weeklyStats).length > 0 ? 1 : 0,
    monthlyStats: Object.keys(data.monthlyStats).length > 0 ? 1 : 0,
  };

  const totalScore = Object.values(scores).reduce(
    (sum, score) => sum + score,
    0
  );
  const completeness = Math.round((totalScore / 6) * 100);

  console.log(`ë°ì´í„° ì™„ì„±ë„: ${completeness}%`, scores);
  return { completeness, details: scores };
};

// 3. generateReport í•¨ìˆ˜ ê°œì„ 
export const generateReport = async (date, type, data, useAI = false) => {
  try {
    // 1. ë¨¼ì € ì €ì¥ëœ ë¦¬í¬íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸
    const existingReport = await getReport(date, type);
    if (existingReport && !useAI) {
      console.log(`ê¸°ì¡´ ${type} ë¦¬í¬íŠ¸ ë°œê²¬:`, date);
      return existingReport;
    }

    // 2. ë°ì´í„° ìœ íš¨ì„± ì¬ê²€ì‚¬
    if (!data.schedules && !data.tasks && !data.studySessions) {
      console.warn("ë¦¬í¬íŠ¸ ìƒì„±ì— í•„ìš”í•œ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
    }

    // 3. ë¦¬í¬íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ í•¨ìˆ˜ í˜¸ì¶œ
    let report;
    switch (type) {
      case REPORT_TYPES.DAILY:
        report = generateDailyReport(date, data);
        break;
      case REPORT_TYPES.WEEKLY:
        report = generateWeeklyReport(date, data);
        break;
      case REPORT_TYPES.MONTHLY:
        report = generateMonthlyReport(date, data);
        break;
      default:
        throw new Error(`ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¦¬í¬íŠ¸ íƒ€ì…: ${type}`);
    }

    // 4. ê³µí†µ ë©”íƒ€ë°ì´í„° ì¶”ê°€
    if (report) {
      report.generatedAt = new Date().toISOString();
      report.dataCompleteness = calculateDataCompleteness(data);
      report.isAIGenerated = useAI;
      report.version = "2.0"; // ë²„ì „ ì¶”ê°€
    }

    // 5. ì²˜ë¦¬ ì§€ì—° ì‹œë®¬ë ˆì´ì…˜ (useAIê°€ trueì¸ ê²½ìš°)
    if (useAI) {
      console.log(`${type} AI ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...`);
      await new Promise((resolve) => {
        simulateProcessing(resolve);
      });
      console.log(`${type} AI ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ`);
    }

    // 6. ë¦¬í¬íŠ¸ ì €ì¥
    const saveSuccess = await saveReport(date, type, report);
    if (!saveSuccess) {
      console.warn(`${type} ë¦¬í¬íŠ¸ ì €ì¥ ì‹¤íŒ¨`);
    }

    console.log(`${type} ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ:`, {
      date,
      useAI,
      dataCompleteness: report.dataCompleteness?.completeness,
    });

    return report;
  } catch (error) {
    console.error(`generateReport ì˜¤ë¥˜ (${type}):`, error);
    throw error;
  }
};

// ì €ì¥ì†Œ ê´€ë ¨ í•¨ìˆ˜ë“¤
export const saveReport = async (date, type, report) => {
  try {
    const key = `${STORAGE_KEYS.REPORTS}_${type}_${date}`;
    await AsyncStorage.setItem(key, JSON.stringify(report));
    return true;
  } catch (error) {
    console.error("ë¦¬í¬íŠ¸ ì €ì¥ ì˜¤ë¥˜:", error);
    return false;
  }
};

export const getReport = async (date, type) => {
  try {
    const key = `${STORAGE_KEYS.REPORTS}_${type}_${date}`;
    const data = await AsyncStorage.getItem(key);
    return data ? JSON.parse(data) : null;
  } catch (error) {
    console.error("ë¦¬í¬íŠ¸ ì¡°íšŒ ì˜¤ë¥˜:", error);
    return null;
  }
};

// ì €ì¥ëœ ëª¨ë“  ë¦¬í¬íŠ¸ ì§€ìš°ê¸° (í…ŒìŠ¤íŠ¸ìš©)
export const clearAllReports = async () => {
  try {
    const keys = await AsyncStorage.getAllKeys();
    const reportKeys = keys.filter((key) =>
      key.startsWith(STORAGE_KEYS.REPORTS)
    );
    await AsyncStorage.multiRemove(reportKeys);
    return true;
  } catch (error) {
    console.error("ë¦¬í¬íŠ¸ ì‚­ì œ ì˜¤ë¥˜:", error);
    return false;
  }
};

// ì €ì¥ëœ AI ë¦¬í¬íŠ¸ ì¡°íšŒ
export const getSavedAIReports = async (reportType) => {
  try {
    const keys = await AsyncStorage.getAllKeys();
    const reportKeys = keys.filter(
      (key) =>
        key.includes(`_${reportType}_`) && key.startsWith(STORAGE_KEYS.REPORTS)
    );

    const reports = {};

    for (const key of reportKeys) {
      const data = await AsyncStorage.getItem(key);
      if (data) {
        const report = JSON.parse(data);

        // ì£¼ê°„/ì›”ê°„ ë¦¬í¬íŠ¸ìš© í‚¤ ìƒì„±
        let reportKey;
        if (reportType === REPORT_TYPES.WEEKLY) {
          // ì£¼ì°¨ ì •ë³´ ì¶”ì¶œ (ex: '2023-W01')
          const date = new Date(report.startDate || report.timestamp);
          const year = date.getFullYear();
          const weekNumber = Math.ceil(
            (date.getDate() + 6 - date.getDay()) / 7
          );
          reportKey = `${year}-W${weekNumber.toString().padStart(2, "0")}`;
        } else {
          // ì›” ì •ë³´ ì¶”ì¶œ (ex: '2023-01')
          const date = new Date(report.startDate || report.timestamp);
          reportKey = format(date, "yyyy-MM");
        }

        reports[reportKey] = report;
      }
    }

    return reports;
  } catch (error) {
    console.error(`ì €ì¥ëœ ${reportType} ë¦¬í¬íŠ¸ ì¡°íšŒ ì˜¤ë¥˜:`, error);
    return {};
  }
};

// ì•Œë¦¼ ê´€ë ¨ í•¨ìˆ˜ ì œê±°ë¨ - ë¬´ë£Œ ë²„ì „ì—ì„œëŠ” ìë™ ì•Œë¦¼ ì—†ìŒ

// ì•Œë¦¼ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì œê±°ë¨ - ë¬´ë£Œ ë²„ì „ì—ì„œëŠ” ë¶ˆí•„ìš”

// ë‚´ë³´ë‚´ê¸°
export default {
  generateReport,
  generateFeedback,
  saveReport,
  getReport,
  clearAllReports,
  simulateProcessing,
  REPORT_TYPES,
  getSavedAIReports,
  processGoalsForReport,
  setReportCallback,
  AUTO_REFRESH_INTERVALS,
};
